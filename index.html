<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Health & Aesthetic Sciences MCQ Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: #2c3e50;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.05) 2px, rgba(0,0,0,.05) 4px);
            min-height: 100vh;
            padding: 20px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        button, .option, .lecture-btn, .shop-tab, .item-btn {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        button:active, .option:active, .lecture-btn:active {
            transform: scale(0.95);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ecf0f1;
            border-radius: 0;
            box-shadow: 
                0 0 0 3px #34495e,
                0 0 0 6px #ecf0f1,
                8px 8px 0 6px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 3px solid #34495e;
        }

        .header {
            background: #34495e;
            color: #ecf0f1;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #2c3e50;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-style: italic;
        }

        .creator-credit {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 0.85em;
            color: #95a5a6;
            font-style: italic;
            text-align: right;
        }

        .creator-credit strong {
            color: #ecf0f1;
            font-weight: bold;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .sidebar {
            width: 300px;
            background: #bdc3c7;
            border-right: 5px solid #34495e;
            padding: 20px;
            overflow-y: auto;
        }

        .lecture-list {
            list-style: none;
        }

        .lecture-item {
            margin-bottom: 10px;
        }

        .lecture-btn {
            width: 100%;
            padding: 15px;
            background: #ecf0f1;
            border: 3px solid #34495e;
            border-radius: 0;
            cursor: pointer;
            font-size: 1em;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            transition: all 0.2s;
            text-align: left;
            color: #2c3e50;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .lecture-btn:hover {
            background: #3498db;
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .lecture-btn.active {
            background: #e74c3c;
            color: white;
            box-shadow: inset 3px 3px 5px rgba(0,0,0,0.3);
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #ecf0f1;
        }

        .welcome-screen {
            text-align: center;
            padding: 50px 20px;
        }

        .welcome-screen h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .welcome-screen p {
            color: #34495e;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .quiz-container {
            display: none;
        }

        .quiz-container.active {
            display: block;
        }

        .quiz-header {
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 0;
            margin-bottom: 30px;
            border: 3px solid #2c3e50;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .quiz-header h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .progress-bar {
            background: #2c3e50;
            height: 15px;
            border-radius: 0;
            overflow: hidden;
            margin-top: 15px;
            border: 2px solid #000;
        }

        .progress-fill {
            background: #e74c3c;
            height: 100%;
            transition: width 0.3s;
        }

        .question-card {
            background: #fff;
            padding: 25px;
            border-radius: 0;
            margin-bottom: 20px;
            border: 3px solid #34495e;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .question-number {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .question-text {
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.6;
            font-weight: bold;
        }

        .options {
            list-style: none;
        }

        .option {
            background: #ecf0f1;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0;
            border: 3px solid #34495e;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .option:hover {
            background: #3498db;
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .option.selected {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        .option.correct {
            border-color: #27ae60;
            background: #2ecc71;
            color: white;
        }

        .option.incorrect {
            border-color: #c0392b;
            background: #e74c3c;
            color: white;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 0;
            display: none;
            border: 3px solid;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border-color: #c0392b;
            color: #721c24;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: space-between;
        }

        .btn {
            padding: 12px 30px;
            border: 3px solid #2c3e50;
            border-radius: 0;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
            font-weight: 600;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .score-display {
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 0;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid #2c3e50;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .score-display h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .score-display .score {
            font-size: 3em;
            font-weight: bold;
            color: #e74c3c;
        }

        .notes-section {
            margin-top: 30px;
            padding: 20px;
            background: #f39c12;
            border-radius: 0;
            border: 3px solid #d68910;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .notes-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-transform: uppercase;
            font-size: 1.2em;
        }

        .notes-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 3px solid #2c3e50;
            border-radius: 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1em;
            resize: vertical;
            background: #fff;
        }

        .notes-section .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .saved-notes {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 0;
            max-height: 300px;
            overflow-y: auto;
            border: 3px solid #34495e;
        }

        .note-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #ecf0f1;
            border-radius: 0;
            border: 2px solid #34495e;
        }

        .note-item .note-lecture {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .note-item .note-text {
            color: #2c3e50;
        }

        .note-item .note-date {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }

        .shop-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #f39c12;
            color: #2c3e50;
            padding: 15px 30px;
            border: 4px solid #d68910;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            z-index: 9999;
            transition: all 0.2s;
            animation: shopPulse 2s infinite;
        }

        .shop-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0 rgba(0,0,0,0.4);
        }

        @keyframes shopPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .shop-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            animation: fadeIn 0.3s;
            overflow-y: auto;
            padding: 20px;
        }

        .shop-modal.active {
            display: flex;
        }

        .shop-content {
            background: #ecf0f1;
            border: 5px solid #34495e;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.4);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .shop-header {
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border-bottom: 5px solid #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-header h2 {
            font-size: 2em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .shop-balance {
            font-size: 1.5em;
            color: #f39c12;
            font-weight: bold;
        }

        .shop-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: 3px solid #c0392b;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
        }

        .shop-close:hover {
            background: #c0392b;
        }

        .shop-tabs {
            display: flex;
            background: #bdc3c7;
            border-bottom: 3px solid #34495e;
        }

        .shop-tab {
            flex: 1;
            padding: 15px;
            background: #95a5a6;
            border: none;
            border-right: 3px solid #34495e;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .shop-tab:hover {
            background: #7f8c8d;
        }

        .shop-tab.active {
            background: #ecf0f1;
        }

        .shop-items {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .shop-item {
            background: white;
            border: 3px solid #34495e;
            padding: 20px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .shop-item:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.3);
        }

        .shop-item.owned {
            background: #d4edda;
            border-color: #27ae60;
        }

        .shop-item.equipped {
            background: #fff3cd;
            border-color: #f39c12;
            position: relative;
        }

        .shop-item.equipped::before {
            content: 'EQUIPPED';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f39c12;
            color: #2c3e50;
            padding: 5px 10px;
            font-size: 0.7em;
            font-weight: bold;
            border: 2px solid #d68910;
        }

        .item-icon {
            font-size: 3em;
            text-align: center;
            margin-bottom: 10px;
        }

        .item-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
            color: #2c3e50;
            text-transform: uppercase;
        }

        .item-description {
            color: #34495e;
            margin-bottom: 10px;
            font-size: 0.9em;
            min-height: 40px;
        }

        .item-price {
            font-size: 1.3em;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .item-btn {
            width: 100%;
            padding: 10px;
            background: #3498db;
            color: white;
            border: 3px solid #2980b9;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .item-btn:hover {
            background: #2980b9;
        }

        .item-btn:disabled {
            background: #95a5a6;
            border-color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .item-btn.equip {
            background: #f39c12;
            border-color: #d68910;
        }

        .item-btn.equip:hover {
            background: #d68910;
        }

        .inventory-display {
            position: fixed;
            top: 100px;
            left: 20px;
            background: #34495e;
            color: #ecf0f1;
            padding: 15px;
            border: 3px solid #2c3e50;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            z-index: 9998;
            font-family: 'Courier New', Courier, monospace;
            max-width: 200px;
        }

        .inventory-display h4 {
            margin-bottom: 10px;
            color: #f39c12;
            text-transform: uppercase;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 5px;
        }

        .inventory-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            padding: 5px;
            background: #2c3e50;
            border: 2px solid #1a252f;
        }

        .inventory-icon {
            font-size: 1.5em;
        }

        .power-up-active {
            animation: powerUpGlow 1s infinite;
        }

        @keyframes powerUpGlow {
            0%, 100% { box-shadow: 0 0 10px #f39c12; }
            50% { box-shadow: 0 0 20px #f39c12, 0 0 30px #f39c12; }
        }

        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 5px); }
            20%, 40%, 60%, 80% { transform: translate(5px, -5px); }
        }

        @keyframes screenFlash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9997;
            animation: screenFlash 0.3s;
        }

        .screen-flash.correct {
            background: radial-gradient(circle, rgba(39, 174, 96, 0.8) 0%, rgba(39, 174, 96, 0) 70%);
        }

        .screen-flash.incorrect {
            background: radial-gradient(circle, rgba(192, 57, 43, 0.8) 0%, rgba(192, 57, 43, 0) 70%);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 10000;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .score-popup {
            position: fixed;
            font-size: 3em;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            z-index: 9999;
            pointer-events: none;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
            animation: scoreFloat 1.5s forwards;
        }

        @keyframes scoreFloat {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translateY(-20px) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translateY(-150px) scale(0.8);
                opacity: 0;
            }
        }

        .mega-combo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            font-weight: bold;
            color: #f39c12;
            text-shadow: 
                3px 3px 0 #e74c3c,
                6px 6px 0 rgba(0,0,0,0.3);
            z-index: 9998;
            pointer-events: none;
            animation: megaComboAppear 2s;
            font-family: 'Courier New', Courier, monospace;
        }

        @keyframes megaComboAppear {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            30% {
                transform: translate(-50%, -50%) scale(1.3) rotate(10deg);
                opacity: 1;
            }
            60% {
                transform: translate(-50%, -50%) scale(0.9) rotate(-5deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
        }

        .star-burst {
            position: fixed;
            width: 20px;
            height: 20px;
            background: #f39c12;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            pointer-events: none;
            z-index: 10000;
        }

        @keyframes starBurst {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: scale(3) rotate(180deg);
                opacity: 0;
            }
        }

        .lightning-effect {
            position: fixed;
            width: 5px;
            height: 100vh;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                #f39c12 20%, 
                #fff 50%, 
                #f39c12 80%, 
                transparent 100%);
            pointer-events: none;
            z-index: 9997;
            animation: lightning 0.1s;
            box-shadow: 0 0 20px #f39c12, 0 0 40px #f39c12;
        }

        @keyframes lightning {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .ripple {
            position: fixed;
            border: 3px solid #27ae60;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            animation: rippleExpand 1s;
        }

        @keyframes rippleExpand {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 300px;
                height: 300px;
                opacity: 0;
            }
        }

        .fire-particle {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            box-shadow: 0 0 10px #e74c3c;
        }

        @keyframes fireRise {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) scale(0);
                opacity: 0;
            }
        }

        .xp-bar-fill {
            animation: xpFillPulse 0.5s;
        }

        @keyframes xpFillPulse {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.02); }
        }

        .question-card {
            animation: questionSlideIn 0.5s;
        }

        @keyframes questionSlideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .stats-panel {
            animation: statsGlow 2s infinite;
        }

        @keyframes statsGlow {
            0%, 100% { box-shadow: 5px 5px 0 rgba(0,0,0,0.2); }
            50% { box-shadow: 5px 5px 0 rgba(0,0,0,0.2), 0 0 20px rgba(231, 76, 60, 0.3); }
        }

        .leaderboard-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px 30px;
            border: 4px solid #c0392b;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            z-index: 9999;
            transition: all 0.2s;
            animation: leaderboardPulse 3s infinite;
        }

        .leaderboard-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0 rgba(0,0,0,0.4);
        }

        @keyframes leaderboardPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .leaderboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10002;
            animation: fadeIn 0.3s;
            overflow-y: auto;
            padding: 20px;
        }

        .leaderboard-modal.active {
            display: flex;
        }

        .leaderboard-content {
            background: #ecf0f1;
            border: 5px solid #34495e;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.4);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .leaderboard-header {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-bottom: 5px solid #c0392b;
            text-align: center;
            position: relative;
        }

        .leaderboard-header h2 {
            font-size: 2.5em;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .leaderboard-subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .leaderboard-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #c0392b;
            color: white;
            border: 3px solid #a93226;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2em;
            z-index: 10;
            transition: all 0.2s;
        }

        .leaderboard-close:hover {
            background: #a93226;
            transform: scale(1.1);
        }

        .leaderboard-tabs {
            display: flex;
            background: #bdc3c7;
            border-bottom: 3px solid #34495e;
        }

        .leaderboard-tab {
            flex: 1;
            padding: 15px;
            background: #95a5a6;
            border: none;
            border-right: 3px solid #34495e;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .leaderboard-tab:hover {
            background: #7f8c8d;
        }

        .leaderboard-tab.active {
            background: #ecf0f1;
        }

        .leaderboard-list {
            padding: 20px;
        }

        .leaderboard-entry {
            background: white;
            border: 3px solid #34495e;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .leaderboard-entry:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .leaderboard-entry.top1 {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            border-color: #d68910;
            animation: topRankGlow 2s infinite;
        }

        .leaderboard-entry.top2 {
            background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
            border-color: #7f8c8d;
        }

        .leaderboard-entry.top3 {
            background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%);
            border-color: #8b5a2b;
        }

        .leaderboard-entry.current-user {
            background: #d4edda;
            border-color: #27ae60;
            font-weight: bold;
        }

        @keyframes topRankGlow {
            0%, 100% { box-shadow: 3px 3px 0 rgba(0,0,0,0.2), 0 0 10px #f39c12; }
            50% { box-shadow: 5px 5px 0 rgba(0,0,0,0.3), 0 0 20px #f39c12; }
        }

        .rank-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            min-width: 50px;
            text-align: center;
        }

        .rank-icon {
            font-size: 2.5em;
            min-width: 50px;
            text-align: center;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .player-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.9em;
            color: #34495e;
        }

        .stat-badge {
            background: #34495e;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            border: 2px solid #2c3e50;
        }

        .username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10003;
            animation: fadeIn 0.3s;
        }

        .username-modal.active {
            display: flex;
        }

        .username-content {
            background: #ecf0f1;
            border: 5px solid #34495e;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.4);
            padding: 40px;
            max-width: 500px;
            width: 90%;
        }

        .username-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 2em;
            text-transform: uppercase;
        }

        .username-content input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #34495e;
            font-family: 'Courier New', Courier, monospace;
            margin-bottom: 20px;
            background: white;
        }

        .username-content input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
        }

        .global-stats {
            background: #34495e;
            color: white;
            padding: 20px;
            margin: 20px;
            border: 3px solid #2c3e50;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .global-stats h3 {
            color: #f39c12;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
        }

        .global-stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .global-stat-item {
            background: #2c3e50;
            padding: 15px;
            border: 2px solid #1a252f;
            text-align: center;
        }

        .global-stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
        }

        .global-stat-label {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }
            
            .container {
                box-shadow: 4px 4px 0 4px rgba(0,0,0,0.3);
            }
            
            .header h1 {
                font-size: 1.5em;
                letter-spacing: 1px;
            }
            
            .header p {
                font-size: 0.9em;
            }
            
            .creator-credit {
                font-size: 0.7em;
                bottom: 5px;
                right: 10px;
            }
            
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 5px solid #34495e;
                padding: 15px;
            }
            
            .sidebar h3 {
                font-size: 1em;
            }
            
            .lecture-btn {
                padding: 12px;
                font-size: 0.9em;
            }

            .content-area {
                padding: 15px;
            }
            
            .quiz-header h2 {
                font-size: 1.3em;
            }
            
            .question-card {
                padding: 15px;
            }
            
            .question-text {
                font-size: 1em;
            }
            
            .option {
                padding: 12px;
                font-size: 0.9em;
            }

            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            .stats-panel {
                padding: 12px;
                font-size: 0.9em;
            }
            
            .stat-item {
                font-size: 0.9em;
            }
            
            .streak-counter {
                top: 70px;
                left: 10px;
                padding: 10px 15px;
                font-size: 1em;
                z-index: 9999;
            }
            
            .achievement-popup {
                top: 10px;
                right: 10px;
                font-size: 0.9em;
                padding: 15px 20px;
                max-width: 80%;
            }
            
            .combo-text {
                font-size: 2.5em;
            }
            
            .mega-combo {
                font-size: 3em;
            }
            
            .score-popup {
                font-size: 2em;
            }
            
            .inventory-display {
                top: auto;
                bottom: 80px;
                left: 10px;
                font-size: 0.75em;
                padding: 10px;
                max-width: 150px;
            }
            
            .inventory-item {
                padding: 3px;
                margin: 3px 0;
            }
            
            .inventory-icon {
                font-size: 1.2em;
            }
            
            .shop-btn {
                bottom: 10px;
                right: 10px;
                padding: 12px 20px;
                font-size: 1em;
                z-index: 9999;
            }
            
            .shop-items {
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 15px;
            }
            
            .shop-content {
                max-width: 100%;
                max-height: 85vh;
            }
            
            .shop-header h2 {
                font-size: 1.5em;
            }
            
            .shop-balance {
                font-size: 1.2em;
            }
            
            .shop-tab {
                padding: 12px 8px;
                font-size: 0.85em;
            }
            
            .shop-item {
                padding: 15px;
            }
            
            .item-icon {
                font-size: 2.5em;
            }
            
            .item-name {
                font-size: 1em;
            }
            
            .item-description {
                font-size: 0.85em;
            }
            
            .notes-section {
                padding: 15px;
            }
            
            .notes-section h3 {
                font-size: 1em;
            }
            
            .notes-section textarea {
                min-height: 100px;
                font-size: 0.9em;
            }
            
            .welcome-screen h2 {
                font-size: 1.5em;
            }
            
            .welcome-screen p {
                font-size: 0.95em;
            }
            
            .score-display {
                padding: 15px;
            }
            
            .score-display h3 {
                font-size: 1.2em;
            }
            
            .score-display .score {
                font-size: 2em;
            }
            
            .leaderboard-btn {
                bottom: 10px;
                left: 10px;
                padding: 10px 20px;
                font-size: 0.95em;
            }
            
            .leaderboard-header h2 {
                font-size: 1.8em;
            }
            
            .leaderboard-subtitle {
                font-size: 0.95em;
            }
            
            .leaderboard-tab {
                padding: 12px 8px;
                font-size: 0.85em;
            }
            
            .leaderboard-entry {
                padding: 12px;
                gap: 10px;
            }
            
            .rank-number {
                font-size: 1.5em;
                min-width: 40px;
            }
            
            .rank-icon {
                font-size: 2em;
                min-width: 40px;
            }
            
            .player-name {
                font-size: 1.1em;
            }
            
            .player-stats {
                font-size: 0.8em;
                gap: 8px;
            }
            
            .stat-badge {
                padding: 2px 6px;
                font-size: 0.85em;
            }
            
            .global-stats {
                padding: 15px;
                margin: 15px;
            }
            
            .global-stat-item {
                padding: 10px;
            }
            
            .global-stat-value {
                font-size: 1.5em;
            }
            
            .username-content {
                padding: 30px 20px;
            }
            
            .username-content h2 {
                font-size: 1.5em;
            }
            
            .username-content input {
                padding: 12px;
                font-size: 1em;
            }
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f39c12;
            color: #2c3e50;
            padding: 20px 30px;
            border: 4px solid #d68910;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideInRight 0.5s, pulse 0.5s 0.5s;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 1.2em;
            text-transform: uppercase;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #e74c3c; }
            50% { box-shadow: 0 0 20px #e74c3c, 0 0 30px #e74c3c; }
        }

        .streak-counter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border: 4px solid #229954;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
            z-index: 9999;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 1.5em;
            animation: glow 2s infinite;
        }

        .streak-counter.fire {
            animation: glow 2s infinite, bounce 0.5s infinite;
        }

        .combo-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: bold;
            color: #e74c3c;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
            z-index: 9998;
            animation: comboAppear 1s;
            pointer-events: none;
            font-family: 'Courier New', Courier, monospace;
        }

        @keyframes comboAppear {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }

        .stats-panel {
            background: #34495e;
            color: #ecf0f1;
            padding: 15px;
            border: 3px solid #2c3e50;
            margin-bottom: 20px;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
        }

        .stats-panel h3 {
            margin-bottom: 10px;
            text-transform: uppercase;
            color: #e74c3c;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #2c3e50;
        }

        .level-bar {
            width: 100%;
            height: 20px;
            background: #2c3e50;
            border: 2px solid #000;
            margin-top: 10px;
            position: relative;
        }

        .level-fill {
            height: 100%;
            background: #e74c3c;
            transition: width 0.5s;
        }

        .level-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .particle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 1s forwards;
            z-index: 10000;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Health & Aesthetic Sciences Quiz</h1>
            <p>Test your knowledge on skin care, aesthetics, and medical sciences</p>
            <div class="creator-credit">
                Created by<br>
                <strong>Al Mustaqbal University</strong>
            </div>
        </div>

        <!-- Shop Button -->
        <button class="shop-btn" onclick="openShop()">
            SHOP
        </button>

        <!-- Leaderboard Button -->
        <button class="leaderboard-btn" onclick="openLeaderboard()">
            RANKS
        </button>

        <!-- Inventory Display -->
        <div class="inventory-display" id="inventoryDisplay" style="display: none;">
            <h4>Inventory</h4>
            <div id="inventoryItems"></div>
        </div>

        <!-- Username Modal -->
        <div class="username-modal" id="usernameModal">
            <div class="username-content">
                <h2>Enter Your Name</h2>
                <p style="text-align: center; margin-bottom: 20px; color: #34495e;">Join the competition and climb the ranks!</p>
                <input type="text" id="usernameInput" placeholder="Enter your username..." maxlength="20">
                <button class="btn btn-primary" onclick="saveUsername()" style="width: 100%;">
                    START COMPETING
                </button>
            </div>
        </div>

        <!-- Leaderboard Modal -->
        <div class="leaderboard-modal" id="leaderboardModal">
            <div class="leaderboard-content">
                <button class="leaderboard-close" onclick="closeLeaderboard()">X</button>
                <div class="leaderboard-header">
                    <h2>LEADERBOARD</h2>
                    <p class="leaderboard-subtitle">Top Players Worldwide</p>
                </div>
                
                <div class="leaderboard-tabs">
                    <button class="leaderboard-tab active" onclick="switchLeaderboardTab('global')">Global</button>
                    <button class="leaderboard-tab" onclick="switchLeaderboardTab('weekly')">This Week</button>
                    <button class="leaderboard-tab" onclick="switchLeaderboardTab('friends')">Friends</button>
                </div>

                <div class="global-stats">
                    <h3>Global Statistics</h3>
                    <div class="global-stat-grid">
                        <div class="global-stat-item">
                            <div class="global-stat-value" id="totalPlayers">0</div>
                            <div class="global-stat-label">Total Players</div>
                        </div>
                        <div class="global-stat-item">
                            <div class="global-stat-value" id="totalQuestions">0</div>
                            <div class="global-stat-label">Questions Answered</div>
                        </div>
                        <div class="global-stat-item">
                            <div class="global-stat-value" id="avgLevel">0</div>
                            <div class="global-stat-label">Average Level</div>
                        </div>
                        <div class="global-stat-item">
                            <div class="global-stat-value" id="bestStreak">0</div>
                            <div class="global-stat-label">Best Streak</div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Populated by JavaScript -->
                </div>

                <div style="padding: 20px; text-align: center; border-top: 3px solid #34495e; background: #ecf0f1;">
                    <button class="btn btn-secondary" onclick="closeLeaderboard()" style="width: 100%; max-width: 300px; padding: 15px; font-size: 1.1em;">
                        CLOSE LEADERBOARD
                    </button>
                </div>
            </div>
        </div>

        <!-- Shop Modal -->
        <div class="shop-modal" id="shopModal">
            <div class="shop-content">
                <button class="shop-close" onclick="closeShop()">X</button>
                <div class="shop-header">
                    <h2>Item Shop</h2>
                    <div class="shop-balance">
                        XP: <span id="shopXP">0</span>
                    </div>
                </div>
                <div class="shop-tabs">
                    <button class="shop-tab active" onclick="switchShopTab('cosmetics')">Cosmetics</button>
                    <button class="shop-tab" onclick="switchShopTab('powerups')">Power-Ups</button>
                    <button class="shop-tab" onclick="switchShopTab('titles')">Titles</button>
                </div>
                <div class="shop-items" id="shopItems">
                    <!-- Items will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="main-content">
            <aside class="sidebar">
                <h3 style="margin-bottom: 20px; color: #667eea;">Select a Lecture</h3>
                <ul class="lecture-list">
                    <li class="lecture-item">
                        <button class="lecture-btn" data-lecture="1">
                            Basic Skin Care Principles
                        </button>
                    </li>
                    <li class="lecture-item">
                        <button class="lecture-btn" data-lecture="2">
                            Acne, Pigmentation & Dryness
                        </button>
                    </li>
                    <li class="lecture-item">
                        <button class="lecture-btn" data-lecture="3">
                            Hydrafacial & Advanced Aesthetics
                        </button>
                    </li>
                    <li class="lecture-item">
                        <button class="lecture-btn" data-lecture="4">
                            Product Labels, Formulation & Blood Tests
                        </button>
                    </li>
                </ul>

                <div class="notes-section" style="margin-top: 30px;">
                    <h3>Quick Notes</h3>
                    <textarea id="noteInput" placeholder="Write your notes here..."></textarea>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveNote()">Save Note</button>
                        <button class="btn btn-secondary" onclick="clearNote()">Clear</button>
                    </div>
                </div>
            </aside>

            <main class="content-area">
                <div class="welcome-screen" id="welcomeScreen">
                    <h2>Welcome to Health & Aesthetic Sciences MCQ Quiz!</h2>
                    <p>Select a lecture from the sidebar to begin testing your knowledge.</p>
                    <p style="margin-top: 20px;">This quiz covers:</p>
                    <ul style="list-style: none; margin-top: 15px; color: #666;">
                        <li> Skin barrier function and care principles</li>
                        <li> Acne pathophysiology and treatment</li>
                        <li> Hydrafacial procedures and aesthetics</li>
                        <li> Product formulation and blood testing</li>
                    </ul>

                    <div class="saved-notes" id="savedNotesList" style="margin-top: 40px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">Your Saved Notes</h3>
                        <div id="notesContainer"></div>
                    </div>
                </div>

                <div class="quiz-container" id="quizContainer">
                    <!-- Streak Counter -->
                    <div class="streak-counter" id="streakCounter" style="display: none;">
                        STREAK: <span id="streakNumber">0</span>
                    </div>
                    
                    <!-- Stats Panel -->
                    <div class="stats-panel" id="statsPanel">
                        <h3>Your Progress</h3>
                        <div class="stat-item">
                            <span>Level:</span>
                            <span id="levelDisplay">1</span>
                        </div>
                        <div class="stat-item">
                            <span>Total XP:</span>
                            <span id="xpDisplay">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Correct Answers:</span>
                            <span id="correctDisplay">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Best Streak:</span>
                            <span id="bestStreakDisplay">0</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="levelFill"></div>
                            <div class="level-text" id="levelText">0 / 100 XP</div>
                        </div>
                    </div>
                    
                    <div class="quiz-header">
                        <h2 id="quizTitle"></h2>
                        <p id="quizProgress"></p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <div id="scoreDisplay" class="score-display" style="display: none;">
                        <h3>Quiz Complete!</h3>
                        <div class="score" id="finalScore"></div>
                        <p id="scoreMessage"></p>
                        <div id="bonusXP" style="margin-top: 15px; font-size: 1.2em; color: #f39c12;"></div>
                    </div>

                    <div id="questionContainer"></div>

                    <div class="controls">
                        <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                        <div>
                            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Next</button>
                            <button class="btn btn-success" id="submitBtn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
                        </div>
                    </div>

                    <button class="btn btn-secondary" onclick="backToHome()" style="margin-top: 20px;">Back to Lectures</button>
                </div>
            </main>
        </div>
    </div>

    <script>
            const quizData = {
        1: {
            title: "Basic Skin Care Principles",
            questions: [
                {
                    question: "What is the primary function of the skin barrier located in the stratum corneum?",
                    options: [
                        "Produce melanin for skin color",
                        "Act as the body's first defense against irritants and water loss",
                        "Generate new skin cells",
                        "Store vitamin D"
                    ],
                    correct: 1,
                    explanation: "The skin barrier in the stratum corneum acts as the body's first defense against irritants and water loss. It's built from corneocytes and a lipid matrix in a 'brick-and-mortar' structure."
                },
                {
                    question: "What is the typical pH range of the skin's natural acid mantle?",
                    options: [
                        "pH 3.0-4.0",
                        "pH 4.5-5.5",
                        "pH 6.5-7.5",
                        "pH 7.5-8.5"
                    ],
                    correct: 1,
                    explanation: "The skin surface has a natural acid mantle with a pH of approximately 4.5-5.5, which helps protect against harmful microorganisms and maintains skin health."
                },
                {
                    question: "What is the main disadvantage of traditional soap cleansers?",
                    options: [
                        "They are too expensive",
                        "They have alkaline pH (9-10) that can disrupt the skin's acid mantle",
                        "They don't remove dirt effectively",
                        "They cause skin to become oily"
                    ],
                    correct: 1,
                    explanation: "Traditional soaps are alkaline with high pH (9-10), which can disrupt the natural acidic environment of the skin (acid mantle), often causing dryness and irritation, especially in sensitive skin."
                },
                {
                    question: "What are Syndet cleansers?",
                    options: [
                        "Natural soap alternatives",
                        "Synthetic detergents formulated closer to skin's natural pH",
                        "Oil-based cleansers",
                        "Antibacterial soaps"
                    ],
                    correct: 1,
                    explanation: "Syndet (synthetic detergent) cleansers are formulated closer to the skin's natural pH, making them milder, less irritating, and more barrier-friendly than traditional soaps."
                },
                {
                    question: "What is the 'brick-and-mortar' structure of the skin barrier composed of?",
                    options: [
                        "Melanocytes and keratin",
                        "Corneocytes and lipid matrix (ceramides, cholesterol, fatty acids)",
                        "Collagen and elastin fibers",
                        "Sebum and sweat"
                    ],
                    correct: 1,
                    explanation: "The skin barrier is built from corneocytes (bricks) and a lipid matrix of ceramides, cholesterol, and fatty acids (mortar) that maintains integrity and controls transepidermal water loss (TEWL)."
                },
                {
                    question: "Which cleansing practice is MOST important for maintaining skin hydration?",
                    options: [
                        "Cleansing three times daily",
                        "Using very hot water",
                        "Moisturizing immediately after cleansing within 3 minutes",
                        "Rubbing skin vigorously with a towel"
                    ],
                    correct: 2,
                    explanation: "Moisturizing immediately after cleansing (within 3 minutes while skin is still slightly damp) helps lock in hydration and reduce transepidermal water loss using the 'soak and seal' method."
                },
                {
                    question: "What is the role of humectants in moisturizers?",
                    options: [
                        "Form a protective film on skin surface",
                        "Attract and bind water from deeper layers or environment",
                        "Fill gaps between cells",
                        "Kill bacteria"
                    ],
                    correct: 1,
                    explanation: "Humectants like glycerin, hyaluronic acid, and urea attract and bind water from deeper skin layers or the environment, helping to hydrate the skin."
                },
                {
                    question: "What do occlusives do in a moisturizer?",
                    options: [
                        "Attract water to the skin",
                        "Smooth rough skin texture",
                        "Form a thin film to trap moisture and block evaporation",
                        "Exfoliate dead skin cells"
                    ],
                    correct: 2,
                    explanation: "Occlusives like petrolatum, dimethicone, and lanolin form a thin film on the skin surface to trap moisture and block evaporation, preventing water loss."
                },
                {
                    question: "Which ingredients help rebuild the skin's 'brick-and-mortar' structure for barrier repair?",
                    options: [
                        "Vitamin C and retinol",
                        "Ceramides, cholesterol, and fatty acids",
                        "Alpha hydroxy acids",
                        "Benzoyl peroxide"
                    ],
                    correct: 1,
                    explanation: "Moisturizers containing ceramides, cholesterol, and fatty acids mimic the skin's natural lipids, helping rebuild its 'brick-and-mortar' structure for effective barrier repair."
                },
                {
                    question: "What does TEWL stand for and what does it measure?",
                    options: [
                        "Total Epidermal Water Level - measures skin hydration",
                        "Transepidermal Water Loss - measures water evaporation through skin",
                        "Topical Emollient Water Layer - measures moisturizer effectiveness",
                        "Tissue Elasticity and Water Loading - measures skin elasticity"
                    ],
                    correct: 1,
                    explanation: "TEWL stands for Transepidermal Water Loss and measures the amount of water that evaporates through the skin, indicating barrier function health."
                },
                {
                    question: "What is the primary cause of photoaging?",
                    options: [
                        "Air pollution",
                        "UV radiation exposure",
                        "Smoking",
                        "Poor diet"
                    ],
                    correct: 1,
                    explanation: "UV exposure is the primary cause of photoaging, which includes wrinkles, pigmentation, loss of elasticity, and increases the risk of skin cancers."
                },
                {
                    question: "What SPF level is recommended for daily sun protection?",
                    options: [
                        "SPF 10 or higher",
                        "SPF 15 or higher",
                        "SPF 30 or higher",
                        "SPF 50 only"
                    ],
                    correct: 2,
                    explanation: "A broad-spectrum sunscreen with SPF 30 or higher should be applied to all exposed areas for adequate daily sun protection."
                },
                {
                    question: "How often should sunscreen be reapplied?",
                    options: [
                        "Once in the morning is sufficient",
                        "Every 2 hours, and immediately after swimming or sweating",
                        "Every 4 hours",
                        "Only when going outdoors"
                    ],
                    correct: 1,
                    explanation: "Sunscreen should be reapplied every 2 hours, and immediately after swimming, sweating, or towel-drying to maintain protection."
                },
                {
                    question: "During what hours is UV exposure typically highest?",
                    options: [
                        "6 AM - 9 AM",
                        "9 AM - 12 PM",
                        "10 AM - 4 PM",
                        "4 PM - 7 PM"
                    ],
                    correct: 2,
                    explanation: "UV exposure is highest between 10 AM and 4 PM. Limiting outdoor exposure during these peak hours helps prevent UV damage."
                },
                {
                    question: "What does UPF stand for in protective clothing?",
                    options: [
                        "Ultimate Protection Factor",
                        "UV Prevention Formula",
                        "UV Protection Factor",
                        "Universal Protective Fabric"
                    ],
                    correct: 2,
                    explanation: "UPF stands for UV Protection Factor. Look for garments with UPF  50 for optimal sun protection through clothing."
                },
                {
                    question: "Which skin condition is characterized by chronic inflammation with defects in the epidermal barrier?",
                    options: [
                        "Psoriasis",
                        "Atopic Dermatitis (Eczema)",
                        "Rosacea",
                        "Vitiligo"
                    ],
                    correct: 1,
                    explanation: "Atopic Dermatitis (eczema) is a chronic inflammatory disorder associated with defects in the epidermal barrier, leading to increased TEWL, dry fragile skin, itching, and recurrent infections."
                },
                {
                    question: "What characterizes Ichthyosis?",
                    options: [
                        "Rapid cell turnover with thick plaques",
                        "Inherited disorders with abnormal keratinization causing scaling",
                        "Loss of skin pigmentation",
                        "Excessive oil production"
                    ],
                    correct: 1,
                    explanation: "Ichthyosis is an inherited group of disorders with abnormal keratinization, resulting in impaired barrier function with scaling, dryness, and thickening ranging from fine to severe plate-like scales."
                },
                {
                    question: "What are the two main types of Contact Dermatitis?",
                    options: [
                        "Acute and Chronic",
                        "Irritant and Allergic",
                        "Primary and Secondary",
                        "Mild and Severe"
                    ],
                    correct: 1,
                    explanation: "Contact Dermatitis has two types: Irritant Contact Dermatitis (direct toxic effects) and Allergic Contact Dermatitis (delayed hypersensitivity reaction)."
                },
                {
                    question: "What is the first-line approach for managing skin barrier disorders?",
                    options: [
                        "Oral antibiotics",
                        "Skin hydration and barrier repair with emollients",
                        "Systemic corticosteroids",
                        "UV light therapy"
                    ],
                    correct: 1,
                    explanation: "Skin hydration and barrier repair using regular emollients and moisturizers (preferably fragrance-free and hypoallergenic) is the first-line management for skin barrier disorders."
                },
                {
                    question: "Which topical agents are commonly used for anti-inflammatory effects in barrier disorders?",
                    options: [
                        "Antibiotics only",
                        "Corticosteroids and calcineurin inhibitors",
                        "Retinoids",
                        "Benzoyl peroxide"
                    ],
                    correct: 1,
                    explanation: "Corticosteroids reduce inflammation, while calcineurin inhibitors (tacrolimus, pimecrolimus) serve as steroid-sparing agents in managing barrier disorders."
                },
                {
                    question: "What are keratolytics used for in treating Ichthyosis?",
                    options: [
                        "Reducing inflammation",
                        "Killing bacteria",
                        "Decreasing scaling (e.g., urea, lactic acid, salicylic acid)",
                        "Increasing pigmentation"
                    ],
                    correct: 2,
                    explanation: "Keratolytics like urea, lactic acid, and salicylic acid are used in Ichthyosis to decrease scaling and improve skin texture."
                },
                {
                    question: "When is systemic therapy indicated for barrier disorders?",
                    options: [
                        "As first-line treatment for all cases",
                        "For moderate to severe cases not responding to topical treatment",
                        "Only for children",
                        "Never recommended"
                    ],
                    correct: 1,
                    explanation: "Systemic therapy with immunosuppressive agents (methotrexate, cyclosporine, azathioprine) is reserved for moderate to severe barrier disorders not responding adequately to topical treatment."
                },
                {
                    question: "Why should lukewarm water be used instead of hot water when bathing?",
                    options: [
                        "Hot water is more expensive",
                        "Hot water increases dryness and barrier damage",
                        "Lukewarm water cleans better",
                        "Hot water causes skin to age faster"
                    ],
                    correct: 1,
                    explanation: "Lukewarm water should be used instead of hot water because hot water increases dryness and can damage the skin barrier."
                },
                {
                    question: "What lifestyle measure helps reduce skin damage from scratching?",
                    options: [
                        "Wearing gloves at all times",
                        "Keeping nails short and clean",
                        "Applying ice to itchy areas",
                        "Taking antihistamines daily"
                    ],
                    correct: 1,
                    explanation: "Keeping nails short and clean helps reduce skin damage from scratching, which is an important supportive measure in managing barrier disorders."
                },
                {
                    question: "Which type of cleanser is suitable for very dry, sensitive, or inflamed skin?",
                    options: [
                        "Traditional soap",
                        "Antibacterial cleanser",
                        "Lipid-free cleanser",
                        "Exfoliating scrub"
                    ],
                    correct: 2,
                    explanation: "Lipid-free cleansers do not contain fats, soaps, or detergents, making them suitable for very dry, sensitive, or inflamed skin such as eczema or dermatitis. Example: Aquanil cleanser."
                },
                {
                    question: "What is an example of an emollient in moisturizers?",
                    options: [
                        "Glycerin",
                        "Hyaluronic acid",
                        "Fatty acids and shea butter",
                        "Petrolatum"
                    ],
                    correct: 2,
                    explanation: "Emollients like fatty acids, squalane, and shea butter fill gaps between cells, smooth rough skin, and improve texture."
                },
                {
                    question: "What should be avoided 3-5 days before applying topical treatments for barrier disorders?",
                    options: [
                        "Drinking water",
                        "Sun exposure and tanning",
                        "Sleeping",
                        "Eating fruits"
                    ],
                    correct: 1,
                    explanation: "Sun exposure and tanning should be avoided for 3-5 days before treatment to prevent additional skin damage and ensure optimal treatment results."
                },
                {
                    question: "What percentage of body water can the skin's lipid matrix help control the loss of?",
                    options: [
                        "10%",
                        "25%",
                        "50%",
                        "The lipid matrix controls transepidermal water loss (TEWL)"
                    ],
                    correct: 3,
                    explanation: "The lipid matrix in the skin barrier controls transepidermal water loss (TEWL), which is the measurement of water evaporating through the skin."
                },
                {
                    question: "At what UV Index (UVI) is protection strongly recommended?",
                    options: [
                        "UVI  1",
                        "UVI  3",
                        "UVI  5",
                        "UVI  10"
                    ],
                    correct: 1,
                    explanation: "When the UV Index is 3 or higher (UVI  3), sun protection is strongly recommended to prevent UV damage."
                },
                {
                    question: "Which areas are often missed when applying sunscreen?",
                    options: [
                        "Forehead and cheeks",
                        "Ears, neck, scalp, hands, and lips",
                        "Arms and legs",
                        "Chest and back"
                    ],
                    correct: 1,
                    explanation: "Often-missed areas when applying sunscreen include ears, neck, scalp, hands, and lips. These areas need special attention during sun protection."
                }
            ]
        },
        2: {
            title: "Acne, Pigmentation, and Skin Dryness",
            questions: [
                {
                    question: "What is Acne Vulgaris?",
                    options: [
                        "A viral infection of the skin",
                        "A chronic inflammatory disease of the pilosebaceous unit",
                        "An allergic reaction to cosmetics",
                        "A fungal skin infection"
                    ],
                    correct: 1,
                    explanation: "Acne vulgaris is a common chronic inflammatory disease of the pilosebaceous unit, characterized by comedones, papules, pustules, nodules, and sometimes cysts."
                },
                {
                    question: "What percentage of adolescents aged 12-24 are affected by acne?",
                    options: [
                        "Nearly 50%",
                        "Nearly 65%",
                        "Nearly 85%",
                        "Nearly 95%"
                    ],
                    correct: 2,
                    explanation: "Acne affects nearly 85% of adolescents aged 12-24 years, making it one of the most common skin conditions."
                },
                {
                    question: "Which of the following is NOT a key pathophysiological mechanism of acne?",
                    options: [
                        "Increased sebum production",
                        "Follicular hyperkeratinization",
                        "Decreased melanin production",
                        "Cutibacterium acnes proliferation"
                    ],
                    correct: 2,
                    explanation: "The four key mechanisms of acne are: increased sebum production, follicular hyperkeratinization, C. acnes proliferation, and inflammation. Melanin production is not a primary factor."
                },
                {
                    question: "What hormone primarily stimulates sebum production in acne?",
                    options: [
                        "Estrogen",
                        "Insulin",
                        "Dihydrotestosterone (DHT) - an androgen",
                        "Thyroid hormone"
                    ],
                    correct: 2,
                    explanation: "Sebum production is stimulated by androgens, especially dihydrotestosterone (DHT), which causes sebaceous glands to enlarge and overproduce sebum."
                },
                {
                    question: "What are open comedones commonly called?",
                    options: [
                        "Whiteheads",
                        "Blackheads",
                        "Papules",
                        "Cysts"
                    ],
                    correct: 1,
                    explanation: "Open comedones are commonly called blackheads. They are dilated follicular openings filled with keratin and lipid; melanin oxidation gives them their black color."
                },
                {
                    question: "What characterizes closed comedones?",
                    options: [
                        "Large, painful nodules",
                        "Small, skin-colored papules with closed follicular orifices",
                        "Pus-filled lesions",
                        "Black plugged pores"
                    ],
                    correct: 1,
                    explanation: "Closed comedones (whiteheads) are small, skin-colored papules with closed follicular orifices."
                },
                {
                    question: "Which acne lesion type extends into the deeper dermis?",
                    options: [
                        "Comedones",
                        "Papules",
                        "Pustules",
                        "Nodules"
                    ],
                    correct: 3,
                    explanation: "Nodules are large, painful, solid lesions extending into the deeper dermis, representing more severe inflammatory acne."
                },
                {
                    question: "What is the most common site affected by acne?",
                    options: [
                        "Arms (80%)",
                        "Face (99%)",
                        "Legs (50%)",
                        "Hands (30%)"
                    ],
                    correct: 1,
                    explanation: "The face is affected in 99% of acne cases, making it the most common site. Other sites include chest, upper back, and shoulders."
                },
                {
                    question: "How is mild acne characterized?",
                    options: [
                        "Extensive nodules and scarring",
                        "Few comedones and papules with minimal inflammation",
                        "Large cystic lesions",
                        "Deep scarring present"
                    ],
                    correct: 1,
                    explanation: "Mild acne is characterized by few comedones and papules with minimal inflammation."
                },
                {
                    question: "What defines severe acne?",
                    options: [
                        "A few blackheads only",
                        "Extensive inflammatory lesions, nodulocystic acne, scarring present",
                        "Only whiteheads visible",
                        "Minimal redness"
                    ],
                    correct: 1,
                    explanation: "Severe acne is characterized by extensive inflammatory lesions, nodulocystic acne, and scarring present."
                },
                {
                    question: "What is the mechanism of action of topical retinoids in acne treatment?",
                    options: [
                        "Kill bacteria directly",
                        "Normalize follicular keratinization and comedolytic",
                        "Reduce oil production only",
                        "Act as antibiotics"
                    ],
                    correct: 1,
                    explanation: "Topical retinoids (tretinoin, adapalene, tazarotene) normalize follicular keratinization and have comedolytic properties, making them first-line for mild acne."
                },
                {
                    question: "Why should benzoyl peroxide be used with topical antibiotics?",
                    options: [
                        "To improve skin hydration",
                        "To prevent antibiotic resistance",
                        "To increase penetration",
                        "To reduce cost"
                    ],
                    correct: 1,
                    explanation: "Benzoyl peroxide should always be combined with topical antibiotics (clindamycin or erythromycin) to prevent antibiotic resistance while providing antibacterial and comedolytic effects."
                },
                {
                    question: "What is the mainstay treatment for papulopustular acne?",
                    options: [
                        "Topical steroids",
                        "Oral antibiotics",
                        "Sunscreen only",
                        "Moisturizers"
                    ],
                    correct: 1,
                    explanation: "Oral antibiotics are the mainstay treatment of papulopustular acne. They reduce bacterial counts and have direct anti-inflammatory effects (e.g., doxycycline, minocycline)."
                },
                {
                    question: "Which medication is used for severe nodulocystic or resistant acne?",
                    options: [
                        "Topical benzoyl peroxide",
                        "Oral isotretinoin",
                        "Topical retinoids only",
                        "Antibacterial soap"
                    ],
                    correct: 1,
                    explanation: "Oral isotretinoin is used for severe nodulocystic or resistant acne. It reduces sebum, normalizes keratinization, and has anti-inflammatory effects. Monitoring is required."
                },
                {
                    question: "What must be monitored when using oral isotretinoin?",
                    options: [
                        "Blood pressure only",
                        "Liver function, lipids, and pregnancy status (teratogenic)",
                        "Heart rate",
                        "Kidney function only"
                    ],
                    correct: 1,
                    explanation: "When using oral isotretinoin, liver function, lipid levels, and pregnancy status must be monitored because isotretinoin is teratogenic and can affect liver and lipid metabolism."
                },
                {
                    question: "Which hormonal therapy can be used for female acne patients?",
                    options: [
                        "Testosterone supplements",
                        "Combined oral contraceptives (COCs) and Spironolactone",
                        "Growth hormone",
                        "Thyroid hormone"
                    ],
                    correct: 1,
                    explanation: "For female acne patients, combined oral contraceptives (COCs) reduce androgen activity, and Spironolactone has antiandrogenic effects."
                },
                {
                    question: "What is a common complication of acne?",
                    options: [
                        "Hair loss",
                        "Post-inflammatory hyperpigmentation and scarring",
                        "Nail changes",
                        "Vision problems"
                    ],
                    correct: 1,
                    explanation: "Common complications of acne include post-inflammatory hyperpigmentation and scarring (atrophic: ice pick, boxcar, rolling; or hypertrophic/keloidal)."
                },
                {
                    question: "How long does it typically take to see effects from acne treatment?",
                    options: [
                        "1-2 days",
                        "1 week",
                        "6-8 weeks",
                        "6 months"
                    ],
                    correct: 2,
                    explanation: "Adherence to treatment is key, as treatment effects may take 6-8 weeks to appear. Patients should be counseled about this expected timeline."
                },
                {
                    question: "What is a misconception about acne that should be clarified with patients?",
                    options: [
                        "Acne affects teenagers",
                        "Acne is due to poor hygiene or diet alone",
                        "Acne can be treated",
                        "Acne affects the face"
                    ],
                    correct: 1,
                    explanation: "A common misconception is that acne is due to poor hygiene or diet alone. Patients should understand that acne is multifactorial and requires proper medical treatment."
                },
                {
                    question: "What type of cosmetics should acne patients use?",
                    options: [
                        "Oil-based products",
                        "Non-comedogenic cosmetics",
                        "Heavy makeup",
                        "Products with strong fragrances"
                    ],
                    correct: 1,
                    explanation: "Acne patients should use non-comedogenic cosmetics to avoid clogging pores and worsening their condition."
                },
                {
                    question: "What defines hyperpigmentation?",
                    options: [
                        "Loss of skin color",
                        "Increased melanin deposition in the skin",
                        "Skin thinning",
                        "Excessive oil production"
                    ],
                    correct: 1,
                    explanation: "Hyperpigmentation is defined by increased melanin deposition in the skin, leading to darkening of affected areas."
                },
                {
                    question: "What causes post-inflammatory hyperpigmentation?",
                    options: [
                        "Sun exposure only",
                        "Follows skin injury or inflammation (acne, eczema)",
                        "Genetic factors alone",
                        "Vitamin deficiency"
                    ],
                    correct: 1,
                    explanation: "Post-inflammatory hyperpigmentation (PIH) occurs following skin injury or inflammation such as acne, eczema, or trauma."
                },
                {
                    question: "What is melasma?",
                    options: [
                        "Complete loss of pigmentation",
                        "Symmetrical brown patches on face due to hormonal influences",
                        "Red patches on skin",
                        "White spots on hands"
                    ],
                    correct: 1,
                    explanation: "Melasma is characterized by symmetrical brown patches typically on the face, often triggered by hormonal influences (pregnancy, oral contraceptives) and sun exposure."
                },
                {
                    question: "What characterizes hypopigmentation?",
                    options: [
                        "Darkening of skin",
                        "Decreased or loss of melanin production",
                        "Redness and inflammation",
                        "Skin thickening"
                    ],
                    correct: 1,
                    explanation: "Hypopigmentation is characterized by decreased or loss of melanin production, resulting in lighter patches of skin."
                },
                {
                    question: "What is vitiligo?",
                    options: [
                        "Uniform darkening of skin",
                        "Autoimmune destruction of melanocytes leading to depigmented patches",
                        "Temporary color change",
                        "Age-related darkening"
                    ],
                    correct: 1,
                    explanation: "Vitiligo is an autoimmune condition causing destruction of melanocytes, resulting in well-defined depigmented patches on the skin."
                },
                {
                    question: "What diagnostic tool can be used to assess pigmentation depth?",
                    options: [
                        "X-ray",
                        "Wood's lamp examination (UV light)",
                        "MRI scan",
                        "CT scan"
                    ],
                    correct: 1,
                    explanation: "Wood's lamp examination using UV light can help assess the depth and extent of pigmentation disorders."
                },
                {
                    question: "What is first-line treatment for hyperpigmentation?",
                    options: [
                        "Oral antibiotics",
                        "Topical agents: hydroquinone, kojic acid, azelaic acid",
                        "Surgery",
                        "Immunosuppressants"
                    ],
                    correct: 1,
                    explanation: "First-line treatment for hyperpigmentation includes topical agents such as hydroquinone, kojic acid, and azelaic acid to reduce melanin production."
                },
                {
                    question: "What is essential in managing both hyperpigmentation and hypopigmentation?",
                    options: [
                        "Daily exfoliation",
                        "Strict sun protection with broad-spectrum sunscreen",
                        "Tanning beds",
                        "Avoiding all moisturizers"
                    ],
                    correct: 1,
                    explanation: "Strict sun protection with broad-spectrum sunscreen is essential in managing all pigmentation disorders, as UV exposure can worsen both hyperpigmentation and hypopigmentation."
                },
                {
                    question: "What is xeroderma (xerosis)?",
                    options: [
                        "Excessive oil production",
                        "Abnormally dry skin due to reduced moisture content",
                        "Skin redness",
                        "Excessive sweating"
                    ],
                    correct: 1,
                    explanation: "Xeroderma (xerosis) is abnormally dry skin resulting from reduced moisture content in the stratum corneum."
                },
                {
                    question: "Which body regions are most prone to dryness?",
                    options: [
                        "Scalp and ears",
                        "Lower legs, hands, forearms, and face",
                        "Upper arms and thighs",
                        "Abdomen and chest"
                    ],
                    correct: 1,
                    explanation: "Regions most prone to dryness include lower legs, hands, forearms, and face due to increased exposure and fewer sebaceous glands."
                },
                {
                    question: "What environmental factor commonly contributes to skin dryness?",
                    options: [
                        "High humidity",
                        "Low humidity and cold weather",
                        "Warm temperatures",
                        "Moderate climate"
                    ],
                    correct: 1,
                    explanation: "Environmental factors like low humidity, cold weather, and indoor heating contribute significantly to skin dryness by reducing moisture in the air."
                },
                {
                    question: "What is a clinical sign of severe dryness?",
                    options: [
                        "Increased oil production",
                        "Scaling, cracking, and fissuring",
                        "Hyperpigmentation",
                        "Excessive sweating"
                    ],
                    correct: 1,
                    explanation: "Clinical signs of severe dryness include scaling, cracking, and fissuring of the skin, which can lead to discomfort and complications."
                },
                {
                    question: "What lifestyle modification helps manage skin dryness?",
                    options: [
                        "Hot showers twice daily",
                        "Using harsh soaps",
                        "Using lukewarm water and applying moisturizer immediately after bathing",
                        "Avoiding all moisturizers"
                    ],
                    correct: 2,
                    explanation: "Using lukewarm (not hot) water and applying moisturizer immediately after bathing helps lock in moisture and prevent dryness."
                },
                {
                    question: "Which ingredient in moisturizers is particularly effective for severe dryness?",
                    options: [
                        "Alcohol",
                        "Fragrance",
                        "Urea and lactic acid",
                        "Menthol"
                    ],
                    correct: 2,
                    explanation: "Urea and lactic acid are keratolytic agents that help exfoliate and hydrate, making them particularly effective for severe dryness."
                },
                {
                    question: "What should patients with chronic dryness avoid?",
                    options: [
                        "Moisturizing",
                        "Harsh soaps and prolonged hot water exposure",
                        "Drinking water",
                        "Gentle cleansers"
                    ],
                    correct: 1,
                    explanation: "Patients with chronic dryness should avoid harsh soaps and prolonged hot water exposure, as these strip natural oils and worsen the condition."
                },
                {
                    question: "What is the psychological impact of acne mentioned in the lecture?",
                    options: [
                        "No psychological impact",
                        "Only affects physical health",
                        "Can cause anxiety, depression, and social withdrawal",
                        "Only affects sleep"
                    ],
                    correct: 2,
                    explanation: "Despite being benign, acne significantly impacts psychosocial wellbeing and quality of life, potentially causing anxiety, depression, and social withdrawal."
                },
                {
                    question: "What bacterial species is primarily involved in acne pathogenesis?",
                    options: [
                        "Staphylococcus aureus",
                        "Cutibacterium acnes (C. acnes)",
                        "Streptococcus pyogenes",
                        "Escherichia coli"
                    ],
                    correct: 1,
                    explanation: "Cutibacterium acnes (C. acnes) is an anaerobic bacterium that colonizes sebum-rich follicles, producing inflammatory mediators and enzymes in acne."
                },
                {
                    question: "What is azelaic acid used for in acne treatment?",
                    options: [
                        "Only as an antibiotic",
                        "Anti-inflammatory and useful for post-inflammatory hyperpigmentation",
                        "As a retinoid replacement",
                        "Only for severe nodular acne"
                    ],
                    correct: 1,
                    explanation: "Azelaic acid has anti-inflammatory properties and is particularly useful for treating post-inflammatory hyperpigmentation (PIH) in acne patients."
                },
                {
                    question: "What type of scar is described as a 'deep, narrow scar'?",
                    options: [
                        "Boxcar scar",
                        "Rolling scar",
                        "Ice pick scar",
                        "Hypertrophic scar"
                    ],
                    correct: 2,
                    explanation: "Ice pick scars are deep, narrow scars that appear as small holes in the skin, resembling marks from an ice pick."
                },
                {
                    question: "What adjunctive therapy uses different light wavelengths for acne?",
                    options: [
                        "X-ray therapy",
                        "LED light therapy (blue for antibacterial, red for anti-inflammatory)",
                        "Infrared heat only",
                        "UV radiation"
                    ],
                    correct: 1,
                    explanation: "LED light therapy uses blue light (antibacterial effect) and red light (anti-inflammatory, collagen promotion) as adjunctive acne treatment."
                },
                {
                    question: "What should patients be educated about regarding acne onset?",
                    options: [
                        "Acne only affects teenagers",
                        "Acne can persist into adulthood and affects all ages",
                        "Acne only appears after age 30",
                        "Acne is only genetic"
                    ],
                    correct: 1,
                    explanation: "While predominantly affecting adolescents, acne can persist into adulthood and affect all ages from 1 day old to elderly, requiring comprehensive patient education."
                }
            ]
        },
        3: {
            title: "Hydrafacial Procedure & Advanced Aesthetics",
            questions: [
                {
                    question: "What is a Hydrafacial?",
                    options: [
                        "A surgical skin procedure",
                        "A non-invasive, multi-step skin rejuvenation treatment",
                        "A type of chemical peel only",
                        "A laser resurfacing technique"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial is a non-invasive, multi-step skin rejuvenation treatment that combines cleansing, exfoliation, extraction, hydration, and antioxidant protection simultaneously."
                },
                {
                    question: "Which of the following is NOT a clinical use of Hydrafacial?",
                    options: [
                        "Treating oily and congested skin",
                        "Minimizing enlarged pores",
                        "Treating severe cystic acne",
                        "Enhancing overall skin texture and tone"
                    ],
                    correct: 2,
                    explanation: "Hydrafacial treats oily skin, minimizes pores, helps with mild acne and blackheads, and enhances texture. It is not designed for severe cystic acne."
                },
                {
                    question: "How long before a Hydrafacial should you stop using retinoids and acids?",
                    options: [
                        "Same day",
                        "1 day prior",
                        "3 days prior",
                        "1 week prior"
                    ],
                    correct: 2,
                    explanation: "Retinoids, acids, and strong exfoliants should be stopped 3 days before treatment to avoid excessive irritation."
                },
                {
                    question: "How long should sun exposure be avoided before a Hydrafacial?",
                    options: [
                        "No need to avoid",
                        "1 day",
                        "3-5 days",
                        "2 weeks"
                    ],
                    correct: 2,
                    explanation: "Sun exposure and tanning should be avoided for 3-5 days before treatment to prevent complications and ensure optimal results."
                },
                {
                    question: "What is the purpose of the cleansing step in Hydrafacial?",
                    options: [
                        "To apply medication",
                        "To remove surface impurities and prepare skin for deeper penetration",
                        "To inject substances",
                        "To numb the skin"
                    ],
                    correct: 1,
                    explanation: "Cleansing removes surface impurities, sebum, and environmental pollutants, preparing the skin for deeper penetration of active agents."
                },
                {
                    question: "How long does the dermabrasion step typically take?",
                    options: [
                        "1-2 minutes",
                        "6-8 minutes",
                        "15-20 minutes",
                        "30 minutes"
                    ],
                    correct: 1,
                    explanation: "The dermabrasion step, which involves exfoliation by chemical solutions or water-based abrasion, typically takes 6-8 minutes."
                },
                {
                    question: "What is used in the dermabrasion step?",
                    options: [
                        "Lasers only",
                        "Mild acids (glycolic/salicylic) or water-based abrasion",
                        "Strong bleaching agents",
                        "Antibiotics"
                    ],
                    correct: 1,
                    explanation: "Dermabrasion involves exfoliation using mild acids like glycolic or salicylic acid, or water-based abrasion to remove dead keratinocytes."
                },
                {
                    question: "What tool is used for opening up pores in Hydrafacial?",
                    options: [
                        "Laser device",
                        "Ultrasonic handle with vibrations",
                        "Manual extraction tool only",
                        "Chemical solution only"
                    ],
                    correct: 1,
                    explanation: "An ultrasonic handle with vibrations is used to increase skin permeability and help loosen clogged pores."
                },
                {
                    question: "What is the purpose of the clay mask step?",
                    options: [
                        "To bleach the skin",
                        "To absorb excess oil, toxins, and impurities",
                        "To inject collagen",
                        "To remove hair"
                    ],
                    correct: 1,
                    explanation: "The clay mask absorbs excess oil, toxins, and impurities, leaving skin refreshed while providing minerals and a calming effect."
                },
                {
                    question: "How does the skin tightening step work?",
                    options: [
                        "By freezing the skin",
                        "By using ultrasound to stimulate fibroblasts and improve collagen production",
                        "By injecting fillers",
                        "By applying strong adhesives"
                    ],
                    correct: 1,
                    explanation: "The skin tightening step uses ultrasound with a lifting handle to stimulate fibroblasts, improving collagen and elastin production."
                },
                {
                    question: "What is delivered during the infusion step?",
                    options: [
                        "Antibiotics only",
                        "Hydrating solutions with hyaluronic acid, peptides, and antioxidants",
                        "Botox",
                        "Steroid medications"
                    ],
                    correct: 1,
                    explanation: "The infusion step uses a jet spray to deliver hydrating solutions containing hyaluronic acid, peptides, and antioxidants deep into the dermis."
                },
                {
                    question: "What does the oxygen spray in the hydration step provide?",
                    options: [
                        "Medication delivery",
                        "Hair removal",
                        "Hydration and revitalization by improving oxygenation",
                        "Skin bleaching"
                    ],
                    correct: 2,
                    explanation: "The oxygen spray hydrates and revitalizes skin cells by improving oxygenation and water retention, enhancing healing and glow."
                },
                {
                    question: "What wavelength of LED light is antibacterial and useful for acne?",
                    options: [
                        "Red light",
                        "Blue light",
                        "Green light",
                        "Yellow light"
                    ],
                    correct: 1,
                    explanation: "Blue LED light has antibacterial properties and is particularly useful for treating acne."
                },
                {
                    question: "What does red LED light therapy promote?",
                    options: [
                        "Bacterial growth",
                        "Anti-inflammatory effects and collagen production",
                        "Skin pigmentation",
                        "Hair growth"
                    ],
                    correct: 1,
                    explanation: "Red LED light has anti-inflammatory effects and promotes collagen production, supporting skin rejuvenation."
                },
                {
                    question: "How long should sun exposure be avoided after a Hydrafacial?",
                    options: [
                        "No need to avoid",
                        "24-48 hours",
                        "1 week",
                        "1 month"
                    ],
                    correct: 1,
                    explanation: "Sun exposure should be avoided for 24-48 hours after treatment, and broad-spectrum sunscreen should be used."
                },
                {
                    question: "How long should harsh products be avoided after treatment?",
                    options: [
                        "Immediately can use",
                        "2-3 days",
                        "1 week",
                        "1 month"
                    ],
                    correct: 1,
                    explanation: "Harsh products like retinoids and acids should be avoided for 2-3 days after treatment to prevent irritation."
                },
                {
                    question: "What is an advantage of Hydrafacial?",
                    options: [
                        "Requires surgery",
                        "Immediate results with no downtime",
                        "Only for specific skin types",
                        "Results take months to appear"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial provides immediate results with no downtime, making it a convenient non-invasive treatment option."
                },
                {
                    question: "Is Hydrafacial suitable for all skin types?",
                    options: [
                        "Only for oily skin",
                        "Only for dry skin",
                        "Yes, suitable for all skin types and tones",
                        "Only for fair skin"
                    ],
                    correct: 2,
                    explanation: "Hydrafacial is suitable for all skin types and tones, and can be customized with different serums and boosters."
                },
                {
                    question: "What should men do regarding facial hair before Hydrafacial?",
                    options: [
                        "Shave on the same day",
                        "Shave the night before, not on the same day",
                        "Never shave",
                        "Wait one week after shaving"
                    ],
                    correct: 1,
                    explanation: "Men should shave facial hair the night before treatment, not on the same day, to avoid irritation."
                },
                {
                    question: "What complication can occur from excessive pressure during dermabrasion?",
                    options: [
                        "Hair growth",
                        "Erythema, sensitivity, or micro-tears",
                        "Increased pigmentation",
                        "Permanent scarring (unlikely with proper technique)"
                    ],
                    correct: 1,
                    explanation: "Excessive pressure during dermabrasion can cause erythema (redness), sensitivity, or micro-tears in the skin."
                },
                {
                    question: "How can complications from dermabrasion be prevented?",
                    options: [
                        "Use maximum pressure",
                        "Avoid excessive pressure and select appropriate chemical concentration",
                        "Skip this step",
                        "Use only on specific areas"
                    ],
                    correct: 1,
                    explanation: "Prevention involves avoiding excessive pressure and selecting appropriate chemical concentration based on skin sensitivity."
                },
                {
                    question: "What should be used during LED therapy to prevent complications?",
                    options: [
                        "No precautions needed",
                        "Protective goggles to protect eyes",
                        "Sunscreen",
                        "Heavy moisturizer"
                    ],
                    correct: 1,
                    explanation: "Protective goggles should always be used during LED therapy to prevent eye irritation."
                },
                {
                    question: "What is a potential complication if the clay mask is left on too long?",
                    options: [
                        "Skin burns",
                        "Dryness or tightness",
                        "Increased oil production",
                        "Permanent discoloration"
                    ],
                    correct: 1,
                    explanation: "If left on too long, clay masks can cause dryness or tightness. Application time should be limited, especially for dry skin."
                },
                {
                    question: "What post-care practice is essential after Hydrafacial?",
                    options: [
                        "Avoid all moisturizers",
                        "Moisturize regularly to maintain barrier function",
                        "Use harsh exfoliants immediately",
                        "Avoid drinking water"
                    ],
                    correct: 1,
                    explanation: "Regular moisturizing after Hydrafacial is essential to maintain barrier function and keep skin hydrated."
                },
                {
                    question: "What should patients do before arriving for Hydrafacial?",
                    options: [
                        "Apply heavy makeup",
                        "Arrive with clean skin (no makeup or heavy creams)",
                        "Skip cleansing",
                        "Apply multiple skincare products"
                    ],
                    correct: 1,
                    explanation: "Patients should arrive with clean skin, free of makeup or heavy creams, to ensure optimal treatment results."
                },
                {
                    question: "Why is staying well hydrated before the session important?",
                    options: [
                        "It's not important",
                        "To improve skin's response to treatment",
                        "To prevent thirst only",
                        "To reduce treatment time"
                    ],
                    correct: 1,
                    explanation: "Staying well hydrated before the session improves the skin's response to treatment and overall results."
                },
                {
                    question: "What should patients inform their provider about before treatment?",
                    options: [
                        "Only their age",
                        "Allergies, medications, and skin conditions",
                        "Their favorite color",
                        "Their exercise routine only"
                    ],
                    correct: 1,
                    explanation: "Patients must inform their provider about allergies, medications, or skin conditions to ensure safe and effective treatment."
                },
                {
                    question: "How long does the complete Hydrafacial procedure typically take?",
                    options: [
                        "5-10 minutes",
                        "Approximately 48 minutes (sum of all steps)",
                        "2 hours",
                        "3 hours"
                    ],
                    correct: 1,
                    explanation: "Adding all steps: Cleansing (2-3) + Dermabrasion (6-8) + Opening pores (9) + Rejuvenation (12) + Tightening (5) + Infusion (4) + Hydration (2) + Light therapy (8) = approximately 48-49 minutes total."
                },
                {
                    question: "Can Hydrafacial be customized?",
                    options: [
                        "No, same treatment for everyone",
                        "Yes, with serums and boosters based on skin concerns",
                        "Only for anti-aging",
                        "Only for acne"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial can be customized with various serums and boosters to address specific skin concerns and needs."
                },
                {
                    question: "What is the key benefit of the infusion step for long-term skin health?",
                    options: [
                        "Temporary color change",
                        "Key for long-term skin glow and hydration",
                        "Hair removal",
                        "Immediate tanning effect"
                    ],
                    correct: 1,
                    explanation: "The infusion step is key for achieving long-term skin glow and hydration by delivering active ingredients deep into the dermis."
                },
                {
                    question: "What is the purpose of using ultrasound frequency in sensitive skin?",
                    options: [
                        "To increase irritation",
                        "To adjust for sensitivity and prevent complications",
                        "To speed up the process",
                        "To create heat damage"
                    ],
                    correct: 1,
                    explanation: "Ultrasound frequency should be adjusted for sensitive skin to prevent temporary redness, swelling, or other complications."
                },
                {
                    question: "Why is the jet spray pressure important during infusion?",
                    options: [
                        "Higher is always better",
                        "To ensure even absorption and prevent complications",
                        "It doesn't matter",
                        "Lower pressure is ineffective"
                    ],
                    correct: 1,
                    explanation: "Correct jet spray pressure ensures even absorption of hydrating solutions and prevents uneven distribution or irritation."
                },
                {
                    question: "What anti-aging benefit does Hydrafacial promote?",
                    options: [
                        "Permanent wrinkle removal",
                        "Collagen stimulation for anti-aging benefits",
                        "Immediate face lift",
                        "Bone restructuring"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial promotes collagen stimulation, which provides anti-aging benefits by improving skin firmness and reducing fine lines."
                },
                {
                    question: "What should be avoided 1 week before Hydrafacial?",
                    options: [
                        "Drinking water",
                        "Chemical peels, lasers, or waxing",
                        "Eating food",
                        "Sleeping"
                    ],
                    correct: 1,
                    explanation: "Chemical peels, lasers, or waxing should be avoided for 1 week before Hydrafacial to prevent complications from over-treating the skin."
                },
                {
                    question: "What makes Hydrafacial different from traditional facials?",
                    options: [
                        "Uses only manual techniques",
                        "Combines multiple steps simultaneously with technology-assisted delivery",
                        "Only focuses on cleansing",
                        "Takes much longer"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial is unique because it combines cleansing, exfoliation, extraction, hydration, and antioxidant protection simultaneously using technology-assisted delivery systems."
                },
                {
                    question: "Is Hydrafacial painful?",
                    options: [
                        "Very painful procedure",
                        "Non-invasive and painless",
                        "Requires local anesthesia",
                        "Only painful for sensitive skin"
                    ],
                    correct: 1,
                    explanation: "Hydrafacial is a non-invasive and painless procedure, which is one of its major advantages."
                },
                {
                    question: "What type of mask is used for oily skin during the rejuvenation step?",
                    options: [
                        "Hydrating mask",
                        "Oil-absorbing clay mask",
                        "No mask needed",
                        "Peel-off mask"
                    ],
                    correct: 1,
                    explanation: "For oily skin, an oil-absorbing clay mask should be used, while hydrating masks are better for dry skin during the rejuvenation step."
                },
                {
                    question: "What wavelength is near-infrared light used for?",
                    options: [
                        "Surface skin only",
                        "Deep tissue healing",
                        "Hair removal",
                        "Teeth whitening"
                    ],
                    correct: 1,
                    explanation: "Near-infrared light wavelengths are used for deep tissue healing during LED therapy in the Hydrafacial procedure."
                },
                {
                    question: "Why is depth of abrasion important during dermabrasion?",
                    options: [
                        "Deeper is always better",
                        "Must be controlled based on skin sensitivity to prevent damage",
                        "Depth doesn't matter",
                        "Should always be superficial"
                    ],
                    correct: 1,
                    explanation: "Depth of abrasion must be carefully controlled based on skin sensitivity to prevent complications while achieving effective exfoliation."
                },
                {
                    question: "What does each step of Hydrafacial base itself on?",
                    options: [
                        "Marketing trends",
                        "Dermatological science",
                        "Customer preferences only",
                        "Random selection"
                    ],
                    correct: 1,
                    explanation: "Each step of Hydrafacial is based on dermatological science and aims to improve skin texture, tone, and overall health using evidence-based methods."
                },
                {
                    question: "What is emphasized regarding proper application of Hydrafacial?",
                    options: [
                        "Speed is most important",
                        "Proper application and post-procedure care are essential to avoid complications",
                        "No special care needed",
                        "Only cost matters"
                    ],
                    correct: 1,
                    explanation: "While considered safe, proper application of the Hydrafacial procedure and appropriate post-procedure care are essential to avoid complications."
                }
            ]
        },
        4: {
            title: "Product Labels, Formulation & Blood Tests",
            questions: [
                {
                    question: "What is the primary purpose of product labeling?",
                    options: [
                        "Only for decoration",
                        "To communicate vital information about composition, price, and manufacturing",
                        "To increase product weight",
                        "To confuse consumers"
                    ],
                    correct: 1,
                    explanation: "Labeling communicates vital information such as composition, price, manufacturing details, and expiry date, giving each product a unique identity in the market."
                },
                {
                    question: "Which category do products designed primarily to cleanse, beautify, or improve appearance fall under?",
                    options: [
                        "Pharmaceuticals",
                        "Cosmetics",
                        "Cosmeceuticals",
                        "Medical devices"
                    ],
                    correct: 1,
                    explanation: "Cosmetics are products designed primarily to cleanse, beautify, or improve appearance without altering body functions (e.g., creams, shampoos, makeup)."
                },
                {
                    question: "What are cosmeceuticals?",
                    options: [
                        "Pure cosmetics only",
                        "Products between cosmetics and pharmaceuticals with biologically active ingredients",
                        "Medical drugs only",
                        "Natural products only"
                    ],
                    correct: 1,
                    explanation: "Cosmeceuticals are positioned between cosmetics and pharmaceuticals, containing biologically active ingredients that may improve skin health or function (e.g., anti-aging serums, whitening creams)."
                },
                {
                    question: "What defines pharmaceutical products?",
                    options: [
                        "Products for beautification only",
                        "Medicinal products to treat, prevent, or diagnose diseases with strict testing",
                        "Over-the-counter cosmetics",
                        "Natural remedies without testing"
                    ],
                    correct: 1,
                    explanation: "Pharmaceuticals are medicinal products formulated to treat, prevent, or diagnose diseases, requiring strict clinical testing and regulatory approval."
                },
                {
                    question: "What does FDA stand for?",
                    options: [
                        "Federal Drug Authority",
                        "Food and Drug Administration",
                        "Federal Dermatology Association",
                        "Food and Dental Agency"
                    ],
                    correct: 1,
                    explanation: "FDA stands for Food and Drug Administration, which regulates the safety, labeling, and marketing of food, drugs, and cosmetics in the United States."
                },
                {
                    question: "What is the role of EMA?",
                    options: [
                        "US regulatory body",
                        "Oversees evaluation and supervision of medicines within the European Union",
                        "Asian pharmaceutical authority",
                        "South American drug agency"
                    ],
                    correct: 1,
                    explanation: "EMA (European Medicines Agency) oversees the evaluation and supervision of medicines within the European Union."
                },
                {
                    question: "What does ISO establish?",
                    options: [
                        "National laws only",
                        "Global standards for quality management, safety, and manufacturing",
                        "Local regulations only",
                        "Individual company policies"
                    ],
                    correct: 1,
                    explanation: "ISO (International Organization for Standardization) establishes global standards for quality management, safety, and manufacturing processes."
                },
                {
                    question: "What type of label shows the brand name, logo, or trademark?",
                    options: [
                        "Descriptive label",
                        "Brand label",
                        "Grade label",
                        "Informative label"
                    ],
                    correct: 1,
                    explanation: "A brand label shows the brand name, logo, or trademark, helping the product stand out and build consumer recognition."
                },
                {
                    question: "What information does a descriptive label provide?",
                    options: [
                        "Only the brand name",
                        "Information about ingredients, usage instructions, and benefits",
                        "Only the price",
                        "Manufacturing date only"
                    ],
                    correct: 1,
                    explanation: "Descriptive labels provide information about the product, including ingredients, usage instructions, and benefits, ensuring consumers understand safe and effective use."
                },
                {
                    question: "What does a grade label indicate?",
                    options: [
                        "Brand popularity",
                        "Quality or standard of the product",
                        "Expiry date",
                        "Price range"
                    ],
                    correct: 1,
                    explanation: "A grade label indicates the quality or standard of the product, helping consumers distinguish between different quality levels."
                },
                {
                    question: "What additional information does an informative label provide?",
                    options: [
                        "Only the brand",
                        "Technical/regulatory info like batch number, dates, storage, certifications",
                        "Only the color",
                        "Marketing claims only"
                    ],
                    correct: 1,
                    explanation: "Informative labels provide additional technical or regulatory information such as batch number, manufacturing date, expiry date, storage conditions, and certifications for traceability and compliance."
                },
                {
                    question: "What is a combination label?",
                    options: [
                        "Only brand information",
                        "Integrates two or more label types in one",
                        "Separate labels for each information type",
                        "No specific format"
                    ],
                    correct: 1,
                    explanation: "A combination label integrates two or more types of labels (e.g., brand + descriptive + informative) in one, which most modern products use for complete information."
                },
                {
                    question: "What is formulation?",
                    options: [
                        "Random mixing of ingredients",
                        "Combining different ingredients in specific proportions for desired properties",
                        "Only packaging design",
                        "Marketing strategy"
                    ],
                    correct: 1,
                    explanation: "Formulation is the process of combining different ingredients in specific proportions to create a product with desired properties and functionality."
                },
                {
                    question: "What determines a product's performance, texture, stability, and safety?",
                    options: [
                        "Packaging only",
                        "Formulation design",
                        "Price point",
                        "Brand name"
                    ],
                    correct: 1,
                    explanation: "In cosmetics and pharmaceuticals, formulation determines a product's performance, texture, stability, and safety."
                },
                {
                    question: "What are active ingredients responsible for?",
                    options: [
                        "Color and fragrance only",
                        "The product's primary effect (e.g., hydration, anti-aging)",
                        "Packaging integrity",
                        "Shelf decoration"
                    ],
                    correct: 1,
                    explanation: "Active ingredients are responsible for the product's primary effect, such as hydration or anti-aging (e.g., hyaluronic acid, niacinamide)."
                },
                {
                    question: "What is the role of excipients/additives?",
                    options: [
                        "Only for color",
                        "Support formulation by providing structure, texture, or functionality",
                        "Only for fragrance",
                        "No specific role"
                    ],
                    correct: 1,
                    explanation: "Excipients/additives support the formulation by providing structure, texture, or functionality (e.g., solvents, emulsifiers, thickeners, fragrances)."
                },
                {
                    question: "Why are preservatives and stabilizers used?",
                    options: [
                        "For color only",
                        "To ensure product safety and shelf-life by preventing microbial growth",
                        "For fragrance",
                        "To increase volume"
                    ],
                    correct: 1,
                    explanation: "Preservatives and stabilizers ensure product safety and shelf-life by preventing microbial growth and degradation (e.g., parabens, phenoxyethanol, antioxidants)."
                },
                {
                    question: "What is the first step in designing a basic formulation?",
                    options: [
                        "Start production immediately",
                        "Define product purpose and target skin type",
                        "Choose packaging",
                        "Set the price"
                    ],
                    correct: 1,
                    explanation: "The first step in designing a formulation is to define the product purpose and identify the target skin type."
                },
                {
                    question: "What tests should be performed during lab trials?",
                    options: [
                        "Only color tests",
                        "Stability, pH, microbial, and sensory tests",
                        "Only price analysis",
                        "Only packaging tests"
                    ],
                    correct: 1,
                    explanation: "Lab trials should include stability tests, pH testing, microbial testing, and sensory evaluation to ensure product quality and safety."
                },
                {
                    question: "What is the final step in formulation design?",
                    options: [
                        "Start selling immediately",
                        "Prepare product documentation and labeling per regulations",
                        "Skip testing",
                        "Ignore regulations"
                    ],
                    correct: 1,
                    explanation: "The final step is to prepare product documentation and labeling according to regulatory requirements."
                },
                {
                    question: "What is blood glucose?",
                    options: [
                        "Blood pressure measurement",
                        "Concentration of glucose in bloodstream serving as main energy source",
                        "White blood cell count",
                        "Cholesterol level"
                    ],
                    correct: 1,
                    explanation: "Blood glucose, or blood sugar, is the concentration of glucose in the bloodstream, which serves as the main source of energy for the body's cells."
                },
                {
                    question: "Which hormone lowers blood glucose?",
                    options: [
                        "Glucagon",
                        "Insulin",
                        "Cortisol",
                        "Adrenaline"
                    ],
                    correct: 1,
                    explanation: "Insulin lowers blood glucose by facilitating its uptake into cells."
                },
                {
                    question: "Which hormone increases blood glucose?",
                    options: [
                        "Insulin",
                        "Glucagon",
                        "Thyroid hormone",
                        "Growth hormone"
                    ],
                    correct: 1,
                    explanation: "Glucagon increases blood glucose by stimulating glycogen breakdown in the liver."
                },
                {
                    question: "What is the normal range for fasting blood glucose?",
                    options: [
                        "40-60 mg/dL",
                        "70-110 mg/dL",
                        "120-150 mg/dL",
                        "160-200 mg/dL"
                    ],
                    correct: 1,
                    explanation: "The normal range for fasting blood glucose (FBG) is 70-110 mg/dL after fasting for at least 8 hours."
                },
                {
                    question: "What does the HbA1c test measure?",
                    options: [
                        "Current blood sugar only",
                        "Average blood glucose level over the last 3 months",
                        "Blood pressure",
                        "Cholesterol"
                    ],
                    correct: 1,
                    explanation: "The Hemoglobin A1c (HbA1c) test measures the average blood glucose level over the last 3 months."
                },
                {
                    question: "What is the normal HbA1c range?",
                    options: [
                        "Less than 5.7%",
                        "6-7%",
                        "8-9%",
                        "Above 10%"
                    ],
                    correct: 0,
                    explanation: "The normal HbA1c range is less than 5.7%."
                },
                {
                    question: "What are hormones?",
                    options: [
                        "Enzymes that digest food",
                        "Chemical messengers secreted by endocrine glands",
                        "Blood cells",
                        "Antibodies"
                    ],
                    correct: 1,
                    explanation: "Hormones are chemical messengers secreted by endocrine glands into the bloodstream, regulating various physiological processes."
                },
                {
                    question: "Which structural class does insulin belong to?",
                    options: [
                        "Steroid hormones",
                        "Proteins and peptides",
                        "Amine hormones",
                        "Lipid hormones"
                    ],
                    correct: 1,
                    explanation: "Insulin is an example of a protein/peptide hormone."
                },
                {
                    question: "Which hormone is an example of a steroid hormone?",
                    options: [
                        "Insulin",
                        "Thyroxine",
                        "Cortisol",
                        "Growth hormone"
                    ],
                    correct: 2,
                    explanation: "Cortisol is an example of a steroid hormone."
                },
                {
                    question: "What functional category does T3 and T4 belong to?",
                    options: [
                        "Reproductive hormones",
                        "Growth and Development hormones",
                        "Stress hormones",
                        "Metabolic hormones only"
                    ],
                    correct: 1,
                    explanation: "T3 (Triiodothyronine) and T4 (Thyroxine) are examples of Growth and Development hormones."
                },
                {
                    question: "What is the normal range for TSH?",
                    options: [
                        "0.1-0.3 mIU/L",
                        "0.4-4.0 mIU/L",
                        "5-10 mIU/L",
                        "10-20 mIU/L"
                    ],
                    correct: 1,
                    explanation: "The normal range for Thyroid Stimulating Hormone (TSH) is 0.4-4.0 mIU/L."
                },
                {
                    question: "What does high TSH indicate?",
                    options: [
                        "Hyperthyroidism",
                        "Hypothyroidism",
                        "Normal function",
                        "Diabetes"
                    ],
                    correct: 1,
                    explanation: "High TSH levels indicate Hypothyroidism (underactive thyroid)."
                },
                {
                    question: "What does low TSH indicate?",
                    options: [
                        "Hypothyroidism",
                        "Hyperthyroidism",
                        "Normal function",
                        "Diabetes"
                    ],
                    correct: 1,
                    explanation: "Low TSH levels indicate Hyperthyroidism (overactive thyroid)."
                },
                {
                    question: "What is the normal range for T3?",
                    options: [
                        "10-50 ng/dL",
                        "80-180 ng/dL",
                        "200-300 ng/dL",
                        "400-500 ng/dL"
                    ],
                    correct: 1,
                    explanation: "The normal range for Triiodothyronine (T3) is 80-180 ng/dL."
                },
                {
                    question: "What is the normal range for cortisol?",
                    options: [
                        "1-3 g/dL",
                        "5-25 g/dL",
                        "30-50 g/dL",
                        "60-100 g/dL"
                    ],
                    correct: 1,
                    explanation: "The normal range for cortisol is 5-25 g/dL."
                },
                {
                    question: "What does high cortisol indicate?",
                    options: [
                        "Addison's disease",
                        "Cushing's disease",
                        "Hypothyroidism",
                        "Diabetes"
                    ],
                    correct: 1,
                    explanation: "High cortisol levels indicate Cushing's disease."
                },
                {
                    question: "What does low cortisol indicate?",
                    options: [
                        "Cushing's disease",
                        "Addison's disease",
                        "Hyperthyroidism",
                        "Diabetes"
                    ],
                    correct: 1,
                    explanation: "Low cortisol levels indicate Addison's disease (adrenal insufficiency)."
                },
                {
                    question: "What is the normal range for progesterone?",
                    options: [
                        "1-3 ng/mL",
                        "5-20 ng/mL",
                        "25-40 ng/mL",
                        "50-80 ng/mL"
                    ],
                    correct: 1,
                    explanation: "The normal range for progesterone is 5-20 ng/mL."
                },
                {
                    question: "What can high progesterone indicate?",
                    options: [
                        "Infertility",
                        "Luteal phase defect",
                        "Menopause",
                        "Normal pregnancy"
                    ],
                    correct: 1,
                    explanation: "High progesterone can indicate luteal phase defect or normal pregnancy."
                },
                {
                    question: "What is the normal range for testosterone in males?",
                    options: [
                        "50-150 ng/dL",
                        "300-1000 ng/dL",
                        "1200-1500 ng/dL",
                        "1600-2000 ng/dL"
                    ],
                    correct: 1,
                    explanation: "The normal range for testosterone in males is 300-1000 ng/dL."
                },
                {
                    question: "What can low testosterone in males indicate?",
                    options: [
                        "Polycystic ovary syndrome",
                        "Hypogonadism",
                        "Cushing's disease",
                        "Hyperthyroidism"
                    ],
                    correct: 1,
                    explanation: "Low testosterone in males can indicate Hypogonadism (decreased testosterone production)."
                },
                {
                    question: "Why are blood tests for hormones performed?",
                    options: [
                        "Only to check blood type",
                        "To measure hormone levels, assess gland function, and diagnose disorders",
                        "To measure blood pressure",
                        "To count blood cells"
                    ],
                    correct: 1,
                    explanation: "Blood tests for hormones measure specific hormone levels to assess endocrine gland function, diagnose hormonal imbalances or disorders, monitor treatments, and guide clinical decisions."
                },
                {
                    question: "What sample type is used for most hormone tests?",
                    options: [
                        "Urine only",
                        "Venous blood",
                        "Saliva only",
                        "Hair sample"
                    ],
                    correct: 1,
                    explanation: "Most hormone tests use venous blood samples for accurate measurement."
                },
                {
                    question: "Where is TSH secreted from?",
                    options: [
                        "Thyroid gland",
                        "Pituitary gland",
                        "Adrenal cortex",
                        "Pancreas"
                    ],
                    correct: 1,
                    explanation: "Thyroid Stimulating Hormone (TSH) is secreted from the pituitary gland."
                },
                {
                    question: "Where is cortisol secreted from?",
                    options: [
                        "Pituitary gland",
                        "Thyroid gland",
                        "Adrenal cortex",
                        "Pancreas"
                    ],
                    correct: 2,
                    explanation: "Cortisol is secreted from the adrenal cortex."
                },
                {
                    question: "Where is progesterone primarily secreted from?",
                    options: [
                        "Testes",
                        "Ovaries",
                        "Pituitary gland",
                        "Thyroid gland"
                    ],
                    correct: 1,
                    explanation: "Progesterone is primarily secreted from the ovaries in females."
                },
                {
                    question: "What condition is associated with high ACTH?",
                    options: [
                        "Addison's disease",
                        "Cushing's disease",
                        "Hypothyroidism",
                        "Diabetes"
                    ],
                    correct: 1,
                    explanation: "High ACTH (Adrenocorticotropic Hormone) is associated with Cushing's disease."
                },
                {
                    question: "What is the normal range for Growth Hormone (GH)?",
                    options: [
                        "1-5 pg/mL",
                        "10-20 pg/mL",
                        "25-35 pg/mL",
                        "40-60 pg/mL"
                    ],
                    correct: 1,
                    explanation: "The normal range for Growth Hormone (GH) is 10-20 pg/mL (though this can vary by lab and time of day)."
                },
                {
                    question: "What can low Growth Hormone indicate?",
                    options: [
                        "Acromegaly",
                        "Growth hormone deficiency",
                        "Cushing's disease",
                        "Hyperthyroidism"
                    ],
                    correct: 1,
                    explanation: "Low Growth Hormone levels can indicate growth hormone deficiency."
                },
                {
                    question: "Why do regulatory authorities monitor product labeling?",
                    options: [
                        "To increase sales",
                        "To ensure safety, quality, and accurate labeling",
                        "To confuse consumers",
                        "To increase prices"
                    ],
                    correct: 1,
                    explanation: "Regulatory authorities ensure that products meet approved standards of safety, quality, and accurate labeling to protect public health."
                }
            ]
        }
    };

        let currentLecture = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizSubmitted = false;

        // Load notes from localStorage
        let savedNotes = JSON.parse(localStorage.getItem('dentistryNotes')) || [];
        
        // Gamification variables
        let currentStreak = 0;
        let bestStreak = parseInt(localStorage.getItem('bestStreak')) || 0;
        let totalXP = parseInt(localStorage.getItem('totalXP')) || 0;
        let userLevel = parseInt(localStorage.getItem('userLevel')) || 1;
        let totalCorrect = parseInt(localStorage.getItem('totalCorrect')) || 0;
        let achievements = JSON.parse(localStorage.getItem('achievements')) || [];
        let lastAnswerCorrect = false;

        // Shop and Inventory
        let ownedItems = JSON.parse(localStorage.getItem('ownedItems')) || [];
        let equippedItems = JSON.parse(localStorage.getItem('equippedItems')) || {};
        let activePowerUps = {};
        let currentShopTab = 'cosmetics';

        // Leaderboard System
        let username = localStorage.getItem('username') || '';
        let currentLeaderboardTab = 'global';
        let leaderboardData = JSON.parse(localStorage.getItem('leaderboardData')) || [];
        
        // Clean out any AI players from previous version
        leaderboardData = leaderboardData.filter(p => !p.isAI);
        localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
        
        let playerStats = {
            username: username,
            level: userLevel,
            xp: totalXP,
            totalCorrect: totalCorrect,
            bestStreak: bestStreak,
            achievements: achievements.length,
            lastActive: new Date().toISOString()
        };

        // Simulated global leaderboard (in production, this would come from a server)
        const generateGlobalLeaderboard = () => {
            const existingPlayer = leaderboardData.find(p => p.username === username);
            
            if (!existingPlayer && username) {
                // Add current player
                leaderboardData.push({
                    username: username,
                    level: userLevel,
                    xp: totalXP,
                    totalCorrect: totalCorrect,
                    bestStreak: bestStreak,
                    achievements: achievements.length,
                    lastActive: new Date().toISOString()
                });
            } else if (existingPlayer) {
                // Update existing player
                existingPlayer.level = userLevel;
                existingPlayer.xp = totalXP;
                existingPlayer.totalCorrect = totalCorrect;
                existingPlayer.bestStreak = bestStreak;
                existingPlayer.achievements = achievements.length;
                existingPlayer.lastActive = new Date().toISOString();
            }
            
            // Sort by XP
            leaderboardData.sort((a, b) => b.xp - a.xp);
            
            // Save to localStorage
            localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
            
            return leaderboardData;
        };

        // Shop Items
        const shopItems = {
            cosmetics: [
                { id: 'theme_blue', name: 'Ocean Theme', icon: '', price: 500, description: 'Cool blue interface colors' },
                { id: 'theme_green', name: 'Forest Theme', icon: '', price: 500, description: 'Calm green interface colors' },
                { id: 'theme_purple', name: 'Royal Theme', icon: '', price: 750, description: 'Majestic purple interface' },
                { id: 'theme_gold', name: 'Golden Theme', icon: '', price: 1000, description: 'Luxurious gold accents' },
                { id: 'theme_dark', name: 'Dark Mode', icon: '', price: 1500, description: 'Easy on the eyes dark theme' },
                { id: 'avatar_scientist', name: 'Scientist Avatar', icon: '', price: 300, description: 'Show your scientific side' },
                { id: 'avatar_graduate', name: 'Graduate Avatar', icon: '', price: 300, description: 'Academic achievement' },
                { id: 'avatar_doctor', name: 'Doctor Avatar', icon: '', price: 500, description: 'Professional medical avatar' },
                { id: 'avatar_expert', name: 'Expert Avatar', icon: '', price: 1000, description: 'Master of dentistry' }
            ],
            powerups: [
                { id: 'double_xp', name: 'Double XP', icon: '', price: 200, description: '2x XP for next 10 questions', type: 'consumable' },
                { id: 'skip_question', name: 'Skip Question', icon: '', price: 150, description: 'Skip any one question', type: 'consumable' },
                { id: 'second_chance', name: 'Second Chance', icon: '', price: 250, description: 'Retry wrong answer once', type: 'consumable' },
                { id: 'hint_master', name: 'Hint Master', icon: '', price: 300, description: 'Show 2 wrong answers for 5 questions', type: 'consumable' },
                { id: 'time_freeze', name: 'Streak Shield', icon: '', price: 400, description: 'Protect streak from 1 wrong answer', type: 'consumable' }
            ],
            titles: [
                { id: 'title_beginner', name: 'Dental Student', icon: '', price: 100, description: 'Show your learning status' },
                { id: 'title_practitioner', name: 'Dental Practitioner', icon: '', price: 500, description: 'Professional title' },
                { id: 'title_specialist', name: 'Specialist', icon: '', price: 1000, description: 'Expert in the field' },
                { id: 'title_master', name: 'Dentistry Master', icon: '', price: 2000, description: 'Master of all topics' },
                { id: 'title_legend', name: 'Dental Legend', icon: '', price: 5000, description: 'Legendary knowledge' }
            ]
        };

        // Achievement definitions
        const achievementList = [
            { id: 'first_correct', name: 'First Blood!', condition: () => totalCorrect >= 1, xp: 50 },
            { id: 'streak_5', name: '5 Streak Master!', condition: () => currentStreak >= 5, xp: 100 },
            { id: 'streak_10', name: '10 Streak Champion!', condition: () => currentStreak >= 10, xp: 250 },
            { id: 'streak_15', name: '15 Streak Legend!', condition: () => currentStreak >= 15, xp: 500 },
            { id: 'correct_25', name: '25 Questions Conquered!', condition: () => totalCorrect >= 25, xp: 200 },
            { id: 'correct_50', name: '50 Questions Mastered!', condition: () => totalCorrect >= 50, xp: 500 },
            { id: 'correct_100', name: '100 Questions Dominated!', condition: () => totalCorrect >= 100, xp: 1000 },
            { id: 'level_5', name: 'Level 5 Achieved!', condition: () => userLevel >= 5, xp: 300 },
            { id: 'level_10', name: 'Level 10 Reached!', condition: () => userLevel >= 10, xp: 750 },
            { id: 'perfect_quiz', name: 'Perfect Score!', condition: () => false, xp: 500 } // Checked separately
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            displaySavedNotes();
            updateStatsDisplay();
            updateInventoryDisplay();
            addButtonSounds();
            
            // Check for username
            if (!username) {
                setTimeout(() => {
                    document.getElementById('usernameModal').classList.add('active');
                }, 1000);
            }
            
            // Generate leaderboard
            generateGlobalLeaderboard();
            
            // Apply saved theme
            const savedTheme = equippedItems.cosmetics;
            if (savedTheme && savedTheme.startsWith('theme_')) {
                applyTheme(savedTheme);
            }
            
            // Re-add button sounds after any dynamic content change
            const observer = new MutationObserver(() => {
                addButtonSounds();
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });

        function setupEventListeners() {
            document.querySelectorAll('.lecture-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lectureId = parseInt(this.dataset.lecture);
                    startQuiz(lectureId);
                });
            });
        }
        
        // Sound effects using Web Audio API
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(100, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } else if (type === 'achievement') {
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'mega') {
                // Epic sound for mega combos
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'click') {
                // Short click sound for buttons
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.05);
            } else if (type === 'hover') {
                // Subtle hover sound
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.03);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.03);
            }
        }
        
        // Add click sound to all buttons
        function addButtonSounds() {
            // Add to all buttons
            document.querySelectorAll('button').forEach(button => {
                if (!button.dataset.soundAdded) {
                    button.addEventListener('click', () => playSound('click'));
                    button.addEventListener('touchstart', () => playSound('click'), { passive: true });
                    button.dataset.soundAdded = 'true';
                }
            });
            
            // Add to lecture buttons
            document.querySelectorAll('.lecture-btn').forEach(btn => {
                if (!btn.dataset.soundAdded) {
                    btn.addEventListener('click', () => playSound('click'));
                    btn.addEventListener('touchstart', () => playSound('click'), { passive: true });
                    btn.dataset.soundAdded = 'true';
                }
            });
            
            // Add to options
            document.querySelectorAll('.option').forEach(option => {
                if (!option.dataset.soundAdded) {
                    option.addEventListener('click', () => playSound('click'));
                    option.addEventListener('touchstart', () => playSound('click'), { passive: true });
                    option.dataset.soundAdded = 'true';
                }
            });
            
            // Add to shop tabs
            document.querySelectorAll('.shop-tab').forEach(tab => {
                if (!tab.dataset.soundAdded) {
                    tab.addEventListener('click', () => playSound('click'));
                    tab.addEventListener('touchstart', () => playSound('click'), { passive: true });
                    tab.dataset.soundAdded = 'true';
                }
            });
        }
        
        // Screen flash effect
        function screenFlash(type) {
            const flash = document.createElement('div');
            flash.className = 'screen-flash ' + type;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 300);
        }
        
        // Screen shake effect
        function screenShake() {
            document.body.style.animation = 'screenShake 0.5s';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 500);
        }
        
        // Confetti explosion
        function createConfetti(x, y) {
            const colors = ['#e74c3c', '#f39c12', '#27ae60', '#3498db', '#9b59b6', '#f1c40f'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = x + 'px';
                confetti.style.top = y + 'px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confettiFall ${2 + Math.random()}s linear`;
                confetti.style.animationDelay = Math.random() * 0.3 + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        // Star burst effect
        function createStarBurst(x, y) {
            for (let i = 0; i < 8; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.style.left = x + 'px';
                star.style.top = y + 'px';
                
                const angle = (360 / 8) * i;
                const distance = 100 + Math.random() * 50;
                const duration = 0.8 + Math.random() * 0.4;
                
                star.style.animation = `starBurst ${duration}s ease-out`;
                star.style.setProperty('--tx', Math.cos(angle * Math.PI / 180) * distance + 'px');
                star.style.setProperty('--ty', Math.sin(angle * Math.PI / 180) * distance + 'px');
                
                document.body.appendChild(star);
                setTimeout(() => star.remove(), duration * 1000);
            }
        }
        
        // Lightning effect
        function createLightning() {
            for (let i = 0; i < 3; i++) {
                const lightning = document.createElement('div');
                lightning.className = 'lightning-effect';
                lightning.style.left = Math.random() * window.innerWidth + 'px';
                lightning.style.animationDelay = i * 0.05 + 's';
                document.body.appendChild(lightning);
                
                setTimeout(() => lightning.remove(), 200);
            }
        }
        
        // Ripple effect
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = (x - 150) + 'px';
            ripple.style.top = (y - 150) + 'px';
            document.body.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 1000);
        }
        
        // Fire particles for high streaks
        function createFireParticles(x, y) {
            for (let i = 0; i < 20; i++) {
                const fire = document.createElement('div');
                fire.className = 'fire-particle';
                fire.style.left = (x + (Math.random() - 0.5) * 100) + 'px';
                fire.style.top = (y + (Math.random() - 0.5) * 50) + 'px';
                fire.style.animation = `fireRise ${1 + Math.random()}s ease-out`;
                fire.style.animationDelay = Math.random() * 0.2 + 's';
                document.body.appendChild(fire);
                
                setTimeout(() => fire.remove(), 1500);
            }
        }
        
        // Score popup
        function showScorePopup(x, y, score, text) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            popup.style.color = score > 0 ? '#27ae60' : '#e74c3c';
            popup.textContent = text;
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 1500);
        }
        
        // Mega combo display
        function showMegaCombo(streak) {
            const mega = document.createElement('div');
            mega.className = 'mega-combo';
            
            let text = '';
            if (streak === 10) text = 'AMAZING!!!';
            else if (streak === 15) text = 'LEGENDARY!!!';
            else if (streak === 20) text = 'UNSTOPPABLE!!!';
            else if (streak >= 25) text = 'GODLIKE!!!';
            
            mega.textContent = text;
            document.body.appendChild(mega);
            
            setTimeout(() => mega.remove(), 2000);
        }
        
        // Pulse XP bar
        function pulseXPBar() {
            const xpBar = document.getElementById('levelFill');
            xpBar.classList.remove('xp-bar-fill');
            void xpBar.offsetWidth; // Trigger reflow
            xpBar.classList.add('xp-bar-fill');
        }
        
        // Create particle explosion
        function createParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = color;
                particle.style.setProperty('--tx', (Math.random() - 0.5) * 200 + 'px');
                particle.style.setProperty('--ty', (Math.random() - 0.5) * 200 + 'px');
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1000);
            }
        }
        
        // Show achievement popup
        function showAchievement(achievement) {
            playSound('achievement');
            
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div>ACHIEVEMENT UNLOCKED!</div>
                <div style="font-size: 1.5em; margin-top: 10px;">${achievement.name}</div>
                <div style="font-size: 1.2em; margin-top: 5px; color: #f39c12;">+${achievement.xp} XP</div>
            `;
            document.body.appendChild(popup);
            
            setTimeout(() => {
                popup.style.animation = 'slideInRight 0.5s reverse';
                setTimeout(() => popup.remove(), 500);
            }, 3000);
        }
        
        // Check and award achievements
        function checkAchievements() {
            achievementList.forEach(achievement => {
                if (!achievements.includes(achievement.id) && achievement.condition()) {
                    achievements.push(achievement.id);
                    localStorage.setItem('achievements', JSON.stringify(achievements));
                    addXP(achievement.xp);
                    showAchievement(achievement);
                }
            });
        }
        
        // Add XP and check for level up
        function addXP(amount) {
            // Apply double XP if active
            if (activePowerUps.doubleXP && activePowerUps.doubleXP > 0) {
                amount *= 2;
                activePowerUps.doubleXP--;
                if (activePowerUps.doubleXP === 0) {
                    delete activePowerUps.doubleXP;
                }
                updateInventoryDisplay();
                
                // Show double XP notification
                showScorePopup(window.innerWidth / 2 + 100, window.innerHeight / 2, amount / 2, '2X ACTIVE!');
            }
            
            totalXP += amount;
            localStorage.setItem('totalXP', totalXP);
            
            const xpForNextLevel = userLevel * 100;
            const currentLevelXP = totalXP % xpForNextLevel;
            
            if (currentLevelXP + amount >= xpForNextLevel) {
                userLevel++;
                localStorage.setItem('userLevel', userLevel);
                showLevelUp();
            }
            
            // Pulse XP bar
            pulseXPBar();
            
            updateStatsDisplay();
            updateLeaderboardStats();
        }
        
        // Show level up animation
        function showLevelUp() {
            const levelUpText = document.createElement('div');
            levelUpText.className = 'mega-combo';
            levelUpText.textContent = 'LEVEL UP!';
            levelUpText.style.color = '#f39c12';
            document.body.appendChild(levelUpText);
            
            playSound('mega');
            createConfetti(window.innerWidth / 2, window.innerHeight / 2);
            createLightning();
            screenFlash('correct');
            
            setTimeout(() => levelUpText.remove(), 2000);
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('levelDisplay').textContent = userLevel;
            document.getElementById('xpDisplay').textContent = totalXP;
            document.getElementById('correctDisplay').textContent = totalCorrect;
            document.getElementById('bestStreakDisplay').textContent = bestStreak;
            
            const xpForNextLevel = userLevel * 100;
            const currentLevelXP = totalXP % xpForNextLevel;
            const percentage = (currentLevelXP / xpForNextLevel) * 100;
            
            document.getElementById('levelFill').style.width = percentage + '%';
            document.getElementById('levelText').textContent = `${currentLevelXP} / ${xpForNextLevel} XP`;
        }
        
        // Update streak counter
        function updateStreak(isCorrect) {
            if (isCorrect) {
                currentStreak++;
                totalCorrect++;
                localStorage.setItem('totalCorrect', totalCorrect);
                
                if (currentStreak > bestStreak) {
                    bestStreak = currentStreak;
                    localStorage.setItem('bestStreak', bestStreak);
                }
                
                document.getElementById('streakCounter').style.display = 'block';
                document.getElementById('streakNumber').textContent = currentStreak;
                
                if (currentStreak >= 5) {
                    document.getElementById('streakCounter').classList.add('fire');
                }
                
                // Show combo text
                if (currentStreak >= 3) {
                    const comboText = document.createElement('div');
                    comboText.className = 'combo-text';
                    comboText.textContent = currentStreak + ' COMBO!';
                    document.body.appendChild(comboText);
                    setTimeout(() => comboText.remove(), 1000);
                }
                
                // Award XP based on streak
                let xpGain = 10;
                if (currentStreak >= 5) xpGain = 20;
                if (currentStreak >= 10) xpGain = 30;
                if (currentStreak >= 15) xpGain = 50;
                
                addXP(xpGain);
                
            } else {
                // Check for streak shield
                if (activePowerUps.streakShield && activePowerUps.streakShield > 0) {
                    activePowerUps.streakShield--;
                    showPowerUpNotification('Streak Shield Saved Your Combo!');
                    updateInventoryDisplay();
                    if (activePowerUps.streakShield === 0) {
                        delete activePowerUps.streakShield;
                    }
                } else {
                    currentStreak = 0;
                    document.getElementById('streakCounter').style.display = 'none';
                    document.getElementById('streakCounter').classList.remove('fire');
                }
            }
            
            checkAchievements();
            updateStatsDisplay();
            updateLeaderboardStats();
        }

        // Shop Functions
        function openShop() {
            document.getElementById('shopModal').classList.add('active');
            document.getElementById('shopXP').textContent = totalXP;
            renderShopItems();
            updateInventoryDisplay();
        }

        function closeShop() {
            document.getElementById('shopModal').classList.remove('active');
        }

        function switchShopTab(tab) {
            currentShopTab = tab;
            document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderShopItems();
        }

        function renderShopItems() {
            const container = document.getElementById('shopItems');
            container.innerHTML = '';
            
            shopItems[currentShopTab].forEach(item => {
                const owned = ownedItems.includes(item.id);
                const equipped = equippedItems[currentShopTab] === item.id;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item' + (owned ? ' owned' : '') + (equipped ? ' equipped' : '');
                
                let buttonHTML = '';
                if (!owned) {
                    const canAfford = totalXP >= item.price;
                    buttonHTML = `<button class="item-btn" onclick="buyItem('${item.id}', '${currentShopTab}')" ${!canAfford ? 'disabled' : ''}>
                        ${canAfford ? 'BUY' : 'NOT ENOUGH XP'}
                    </button>`;
                } else if (item.type === 'consumable') {
                    const count = ownedItems.filter(id => id === item.id).length;
                    buttonHTML = `<button class="item-btn equip" onclick="usePowerUp('${item.id}')">
                        USE (${count})
                    </button>`;
                } else if (!equipped) {
                    buttonHTML = `<button class="item-btn equip" onclick="equipItem('${item.id}', '${currentShopTab}')">
                        EQUIP
                    </button>`;
                } else {
                    buttonHTML = `<button class="item-btn" style="background: #27ae60; border-color: #229954;" disabled>
                        EQUIPPED
                    </button>`;
                }
                
                itemDiv.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-price">${item.price} XP</div>
                    ${buttonHTML}
                `;
                
                container.appendChild(itemDiv);
            });
            
            // Add button sounds to shop items
            setTimeout(() => addButtonSounds(), 50);
        }

        function buyItem(itemId, category) {
            const item = shopItems[category].find(i => i.id === itemId);
            if (totalXP >= item.price) {
                totalXP -= item.price;
                localStorage.setItem('totalXP', totalXP);
                ownedItems.push(itemId);
                localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
                
                // Play purchase sound
                playSound('achievement');
                createParticles(window.innerWidth / 2, window.innerHeight / 2, '#f39c12');
                
                // Auto-equip if not consumable
                if (!item.type) {
                    equipItem(itemId, category);
                }
                
                document.getElementById('shopXP').textContent = totalXP;
                updateStatsDisplay();
                renderShopItems();
                
                // Show purchase notification
                const notification = document.createElement('div');
                notification.className = 'achievement-popup';
                notification.innerHTML = `
                    <div>ITEM PURCHASED!</div>
                    <div style="font-size: 1.5em; margin-top: 10px;">${item.name}</div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
            }
        }

        function equipItem(itemId, category) {
            equippedItems[category] = itemId;
            localStorage.setItem('equippedItems', JSON.stringify(equippedItems));
            
            // Apply theme if it's a theme
            if (itemId.startsWith('theme_')) {
                applyTheme(itemId);
            }
            
            renderShopItems();
            updateInventoryDisplay();
            
            playSound('correct');
        }

        function applyTheme(themeId) {
            const themes = {
                theme_blue: { primary: '#3498db', secondary: '#2980b9', accent: '#5dade2' },
                theme_green: { primary: '#27ae60', secondary: '#229954', accent: '#58d68d' },
                theme_purple: { primary: '#9b59b6', secondary: '#8e44ad', accent: '#bb8fce' },
                theme_gold: { primary: '#f39c12', secondary: '#d68910', accent: '#f8c471' },
                theme_dark: { primary: '#2c3e50', secondary: '#1a252f', accent: '#34495e' }
            };
            
            const theme = themes[themeId];
            if (theme) {
                document.documentElement.style.setProperty('--theme-primary', theme.primary);
                document.documentElement.style.setProperty('--theme-secondary', theme.secondary);
                document.documentElement.style.setProperty('--theme-accent', theme.accent);
            }
        }

        function usePowerUp(powerUpId) {
            if (!ownedItems.includes(powerUpId)) return;
            
            // Remove one instance of the power-up
            const index = ownedItems.indexOf(powerUpId);
            ownedItems.splice(index, 1);
            localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
            
            // Activate power-up
            activatePowerUp(powerUpId);
            
            playSound('achievement');
            renderShopItems();
            updateInventoryDisplay();
        }

        function activatePowerUp(powerUpId) {
            switch(powerUpId) {
                case 'double_xp':
                    activePowerUps.doubleXP = 10;
                    showPowerUpNotification('Double XP Active for 10 questions!');
                    break;
                case 'skip_question':
                    activePowerUps.skipQuestion = 1;
                    showPowerUpNotification('Skip Question Available!');
                    break;
                case 'second_chance':
                    activePowerUps.secondChance = 1;
                    showPowerUpNotification('Second Chance Active!');
                    break;
                case 'hint_master':
                    activePowerUps.hintMaster = 5;
                    showPowerUpNotification('Hint Master Active for 5 questions!');
                    break;
                case 'time_freeze':
                    activePowerUps.streakShield = 1;
                    showPowerUpNotification('Streak Shield Active!');
                    break;
            }
            updateInventoryDisplay();
        }

        function showPowerUpNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'achievement-popup';
            notification.style.background = '#3498db';
            notification.style.borderColor = '#2980b9';
            notification.innerHTML = `
                <div>POWER-UP ACTIVATED!</div>
                <div style="font-size: 1.2em; margin-top: 10px;">${message}</div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2500);
        }

        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventoryDisplay');
            const itemsContainer = document.getElementById('inventoryItems');
            
            itemsContainer.innerHTML = '';
            
            // Show equipped items
            let hasItems = false;
            Object.entries(equippedItems).forEach(([category, itemId]) => {
                const item = shopItems[category].find(i => i.id === itemId);
                if (item && !item.type) {
                    hasItems = true;
                    itemsContainer.innerHTML += `
                        <div class="inventory-item">
                            <div class="inventory-icon">${item.icon}</div>
                            <div style="font-size: 0.85em;">${item.name.split(' ')[0]}</div>
                        </div>
                    `;
                }
            });
            
            // Show active power-ups
            Object.entries(activePowerUps).forEach(([power, count]) => {
                if (count > 0) {
                    hasItems = true;
                    const icons = {
                        doubleXP: '',
                        skipQuestion: '',
                        secondChance: '',
                        hintMaster: '',
                        streakShield: ''
                    };
                    itemsContainer.innerHTML += `
                        <div class="inventory-item power-up-active">
                            <div class="inventory-icon">${icons[power]}</div>
                            <div style="font-size: 0.85em;">${count}</div>
                        </div>
                    `;
                }
            });
            
            inventoryDiv.style.display = hasItems ? 'block' : 'none';
        }

        // Leaderboard Functions
        function checkUsername() {
            if (!username) {
                document.getElementById('usernameModal').classList.add('active');
                return false;
            }
            return true;
        }

        function saveUsername() {
            const input = document.getElementById('usernameInput').value.trim();
            if (input.length < 2) {
                alert('Username must be at least 2 characters!');
                return;
            }
            
            username = input;
            localStorage.setItem('username', username);
            document.getElementById('usernameModal').classList.remove('active');
            
            // Show welcome message
            const notification = document.createElement('div');
            notification.className = 'achievement-popup';
            notification.style.background = '#e74c3c';
            notification.style.borderColor = '#c0392b';
            notification.innerHTML = `
                <div>WELCOME TO THE ARENA!</div>
                <div style="font-size: 1.5em; margin-top: 10px;">${username}</div>
            `;
            document.body.appendChild(notification);
            playSound('achievement');
            setTimeout(() => notification.remove(), 3000);
            
            // Update leaderboard
            generateGlobalLeaderboard();
            openLeaderboard();
        }

        function openLeaderboard() {
            if (!checkUsername()) return;
            
            playSound('click');
            generateGlobalLeaderboard();
            const modal = document.getElementById('leaderboardModal');
            modal.classList.add('active');
            renderLeaderboard();
            updateGlobalStats();
            addButtonSounds();
            
            // Add click-outside-to-close
            setTimeout(() => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeLeaderboard();
                    }
                });
            }, 100);
        }

        function closeLeaderboard() {
            playSound('click');
            document.getElementById('leaderboardModal').classList.remove('active');
        }

        function switchLeaderboardTab(tab) {
            currentLeaderboardTab = tab;
            document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboardList');
            list.innerHTML = '';
            
            let data = [...leaderboardData];
            
            // Filter based on tab
            if (currentLeaderboardTab === 'weekly') {
                const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                data = data.filter(p => new Date(p.lastActive) > oneWeekAgo);
            } else if (currentLeaderboardTab === 'friends') {
                // For now, just show players who are not AI
                data = data.filter(p => !p.isAI);
            }
            
            // Sort by XP
            data.sort((a, b) => b.xp - a.xp);
            
            // Show empty state if no players
            if (data.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.style.cssText = 'text-align: center; padding: 60px 20px; color: #7f8c8d;';
                emptyState.innerHTML = `
                    <div style="font-size: 4em; margin-bottom: 20px;"></div>
                    <h3 style="color: #34495e; margin-bottom: 10px; font-size: 1.5em;">No Players Yet!</h3>
                    <p style="font-size: 1.1em;">Be the first to climb the ranks!</p>
                    <p style="margin-top: 20px; font-size: 0.95em;">Complete quizzes to earn XP and appear on the leaderboard.</p>
                `;
                list.appendChild(emptyState);
                return;
            }
            
            // Render top 50
            data.slice(0, 50).forEach((player, index) => {
                const rank = index + 1;
                const isCurrentUser = player.username === username;
                
                let entryClass = 'leaderboard-entry';
                if (rank === 1) entryClass += ' top1';
                else if (rank === 2) entryClass += ' top2';
                else if (rank === 3) entryClass += ' top3';
                if (isCurrentUser) entryClass += ' current-user';
                
                let rankDisplay = '';
                if (rank === 1) rankDisplay = '<div class="rank-icon"></div>';
                else if (rank === 2) rankDisplay = '<div class="rank-icon"></div>';
                else if (rank === 3) rankDisplay = '<div class="rank-icon"></div>';
                else rankDisplay = `<div class="rank-number">#${rank}</div>`;
                
                const entry = document.createElement('div');
                entry.className = entryClass;
                entry.innerHTML = `
                    ${rankDisplay}
                    <div class="player-info">
                        <div class="player-name">${player.username}${isCurrentUser ? ' (YOU)' : ''}</div>
                        <div class="player-stats">
                            <span class="stat-badge">Level ${player.level}</span>
                            <span class="stat-badge">${player.xp} XP</span>
                            <span class="stat-badge">${player.totalCorrect} Correct</span>
                            <span class="stat-badge">${player.bestStreak} Best Streak</span>
                            <span class="stat-badge">${player.achievements} Achievements</span>
                        </div>
                    </div>
                `;
                
                list.appendChild(entry);
            });
            
            // If current user not in top 50, show their position at bottom
            const currentUserRank = data.findIndex(p => p.username === username) + 1;
            if (currentUserRank > 50) {
                const currentUser = data.find(p => p.username === username);
                const separator = document.createElement('div');
                separator.style.cssText = 'text-align: center; padding: 20px; color: #7f8c8d; font-weight: bold;';
                separator.textContent = '...';
                list.appendChild(separator);
                
                const entry = document.createElement('div');
                entry.className = 'leaderboard-entry current-user';
                entry.innerHTML = `
                    <div class="rank-number">#${currentUserRank}</div>
                    <div class="player-info">
                        <div class="player-name">${currentUser.username} (YOU)</div>
                        <div class="player-stats">
                            <span class="stat-badge">Level ${currentUser.level}</span>
                            <span class="stat-badge">${currentUser.xp} XP</span>
                            <span class="stat-badge">${currentUser.totalCorrect} Correct</span>
                            <span class="stat-badge">${currentUser.bestStreak} Best Streak</span>
                            <span class="stat-badge">${currentUser.achievements} Achievements</span>
                        </div>
                    </div>
                `;
                list.appendChild(entry);
            }
        }

        function updateGlobalStats() {
            const totalPlayers = leaderboardData.length;
            const totalQuestions = leaderboardData.reduce((sum, p) => sum + p.totalCorrect, 0);
            const avgLevel = totalPlayers > 0 ? Math.round(leaderboardData.reduce((sum, p) => sum + p.level, 0) / totalPlayers) : 0;
            const globalBestStreak = leaderboardData.length > 0 ? Math.max(...leaderboardData.map(p => p.bestStreak)) : 0;
            
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalQuestions').textContent = totalQuestions.toLocaleString();
            document.getElementById('avgLevel').textContent = avgLevel;
            document.getElementById('bestStreak').textContent = globalBestStreak;
        }

        function updateLeaderboardStats() {
            if (!username) return;
            
            const player = leaderboardData.find(p => p.username === username);
            if (player) {
                player.level = userLevel;
                player.xp = totalXP;
                player.totalCorrect = totalCorrect;
                player.bestStreak = bestStreak;
                player.achievements = achievements.length;
                player.lastActive = new Date().toISOString();
                
                leaderboardData.sort((a, b) => b.xp - a.xp);
                localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
            }
        }

        function startQuiz(lectureId) {
            currentLecture = lectureId;
            currentQuestionIndex = 0;
            userAnswers = new Array(quizData[lectureId].questions.length).fill(null);
            quizSubmitted = false;
            currentStreak = 0;

            // Update UI
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('quizContainer').classList.add('active');
            document.getElementById('scoreDisplay').style.display = 'none';
            document.getElementById('streakCounter').style.display = 'none';
            document.getElementById('quizTitle').textContent = quizData[lectureId].title;

            // Update active button
            document.querySelectorAll('.lecture-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.lecture) === lectureId) {
                    btn.classList.add('active');
                }
            });

            updateStatsDisplay();
            displayQuestion();
            
            // Add button sounds
            setTimeout(() => addButtonSounds(), 100);
        }

        function displayQuestion() {
            const lecture = quizData[currentLecture];
            const question = lecture.questions[currentQuestionIndex];
            
            document.getElementById('quizProgress').textContent = 
                `Question ${currentQuestionIndex + 1} of ${lecture.questions.length}`;
            
            const progress = ((currentQuestionIndex + 1) / lecture.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            let html = `
                <div class="question-card">
                    <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                    <ul class="options">
            `;

            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestionIndex] === index;
                const isCorrect = index === question.correct;
                let optionClass = 'option';
                
                if (quizSubmitted) {
                    optionClass += ' disabled';
                    if (isSelected && isCorrect) {
                        optionClass += ' correct';
                    } else if (isSelected && !isCorrect) {
                        optionClass += ' incorrect';
                    } else if (isCorrect) {
                        optionClass += ' correct';
                    }
                } else if (isSelected) {
                    optionClass += ' selected';
                }

                html += `
                    <li class="${optionClass}" onclick="${!quizSubmitted ? `selectAnswer(${index})` : ''}">
                        ${String.fromCharCode(65 + index)}. ${option}
                    </li>
                `;
            });

            html += `</ul>`;

            if (quizSubmitted && userAnswers[currentQuestionIndex] !== null) {
                const isCorrectAnswer = userAnswers[currentQuestionIndex] === question.correct;
                html += `
                    <div class="feedback show ${isCorrectAnswer ? 'correct' : 'incorrect'}">
                        <strong>${isCorrectAnswer ? 'Correct!' : 'Incorrect'}</strong><br>
                        ${question.explanation}
                    </div>
                `;
            }

            html += `</div>`;
            document.getElementById('questionContainer').innerHTML = html;

            // Update button visibility
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === lecture.questions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = quizSubmitted ? 'none' : 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
            
            // Add button sounds to new elements
            setTimeout(() => addButtonSounds(), 50);
        }

        function displayQuestion() {
            const lecture = quizData[currentLecture];
            const question = lecture.questions[currentQuestionIndex];
            
            document.getElementById('quizProgress').textContent = 
                `Question ${currentQuestionIndex + 1} of ${lecture.questions.length}`;
            
            const progress = ((currentQuestionIndex + 1) / lecture.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            let html = `
                <div class="question-card">
                    <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                    <ul class="options">
            `;

            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestionIndex] === index;
                const isCorrect = index === question.correct;
                let optionClass = 'option';
                
                if (quizSubmitted) {
                    optionClass += ' disabled';
                    if (isSelected && isCorrect) {
                        optionClass += ' correct';
                    } else if (isSelected && !isCorrect) {
                        optionClass += ' incorrect';
                    } else if (isCorrect) {
                        optionClass += ' correct';
                    }
                } else if (isSelected) {
                    optionClass += ' selected';
                }

                html += `
                    <li class="${optionClass}" onclick="${!quizSubmitted ? `selectAnswer(${index})` : ''}">
                        ${String.fromCharCode(65 + index)}. ${option}
                    </li>
                `;
            });

            html += `</ul>`;

            if (quizSubmitted && userAnswers[currentQuestionIndex] !== null) {
                const isCorrectAnswer = userAnswers[currentQuestionIndex] === question.correct;
                html += `
                    <div class="feedback show ${isCorrectAnswer ? 'correct' : 'incorrect'}">
                        <strong>${isCorrectAnswer ? ' Correct!' : ' Incorrect'}</strong><br>
                        ${question.explanation}
                    </div>
                `;
            }

            html += `</div>`;
            document.getElementById('questionContainer').innerHTML = html;

            // Update button visibility
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === lecture.questions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = quizSubmitted ? 'none' : 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
        }

        function selectAnswer(index) {
            if (quizSubmitted) return;
            userAnswers[currentQuestionIndex] = index;
            
            // Show instant feedback
            const lecture = quizData[currentLecture];
            const question = lecture.questions[currentQuestionIndex];
            const isCorrect = index === question.correct;
            
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // Play sound and create visual effects
            if (isCorrect) {
                playSound('correct');
                
                // Screen flash
                screenFlash('correct');
                
                // Ripple effect
                createRipple(centerX, centerY);
                
                // Particles
                createParticles(centerX, centerY, '#27ae60');
                
                // Star burst
                createStarBurst(centerX, centerY);
                
                // XP calculation
                let xpGain = 10;
                if (currentStreak >= 5) xpGain = 20;
                if (currentStreak >= 10) xpGain = 30;
                if (currentStreak >= 15) xpGain = 50;
                
                // Show score popup
                showScorePopup(centerX - 50, centerY - 100, xpGain, '+' + xpGain + ' XP');
                
                // Confetti for streaks
                if (currentStreak >= 3) {
                    createConfetti(centerX, centerY);
                }
                
                // Fire particles for high streaks
                if (currentStreak >= 5) {
                    createFireParticles(centerX, 100);
                }
                
                // Lightning for mega combos
                if (currentStreak >= 10) {
                    createLightning();
                }
                
                // Mega combo text
                if (currentStreak === 10 || currentStreak === 15 || currentStreak === 20 || currentStreak >= 25) {
                    showMegaCombo(currentStreak + 1);
                    playSound('mega');
                }
                
                // Pulse XP bar
                pulseXPBar();
                
            } else {
                playSound('incorrect');
                
                // Screen shake
                screenShake();
                
                // Screen flash
                screenFlash('incorrect');
                
                // Particles
                createParticles(centerX, centerY, '#c0392b');
                
                // Show miss text
                showScorePopup(centerX - 50, centerY - 100, 0, 'MISS!');
            }
            
            // Update streak
            updateStreak(isCorrect);
            
            // Show modal popup
            showFeedbackModal(isCorrect, question.explanation);
            
            displayQuestion();
        }
        
        function showFeedbackModal(isCorrect, explanation) {
            // Create modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(44, 62, 80, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: #ecf0f1;
                padding: 40px;
                border-radius: 0;
                max-width: 600px;
                width: 90%;
                box-shadow: 
                    0 0 0 5px #34495e,
                    8px 8px 0 5px rgba(0,0,0,0.3);
                animation: slideUp 0.3s;
                position: relative;
                border: 5px solid #34495e;
            `;
            
            // Escape HTML in explanation to prevent issues
            const safeExplanation = explanation.replace(/&/g, '&amp;')
                                                .replace(/</g, '&lt;')
                                                .replace(/>/g, '&gt;')
                                                .replace(/"/g, '&quot;')
                                                .replace(/'/g, '&#039;');
            
            const icon = isCorrect ? 'CORRECT' : 'INCORRECT';
            const title = isCorrect ? 'Correct Answer!' : 'Incorrect Answer';
            const color = isCorrect ? '#27ae60' : '#c0392b';
            const bgColor = isCorrect ? '#d4edda' : '#f8d7da';
            const btnColor = isCorrect ? '#27ae60' : '#3498db';
            
            modalContent.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2.5em; margin-bottom: 20px; font-weight: bold; color: ${color}; 
                                font-family: 'Courier New', Courier, monospace; letter-spacing: 3px; 
                                text-shadow: 3px 3px 0 rgba(0,0,0,0.2);">
                        ${icon}
                    </div>
                    <h2 style="color: ${color}; margin-bottom: 20px; font-size: 1.8em; text-transform: uppercase; 
                               font-family: 'Courier New', Courier, monospace;">
                        ${title}
                    </h2>
                    <div style="background: ${bgColor}; 
                                padding: 20px; 
                                border-radius: 0; 
                                border: 3px solid ${color};
                                text-align: left;
                                margin-bottom: 20px;
                                color: #2c3e50;
                                font-size: 1em;
                                line-height: 1.6;
                                font-family: 'Courier New', Courier, monospace;">
                        <strong>Explanation:</strong><br><br>
                        ${safeExplanation}
                    </div>
                    <button id="continueBtn"
                            style="background: ${btnColor}; 
                                   color: white; 
                                   padding: 15px 40px; 
                                   border: 3px solid #2c3e50; 
                                   border-radius: 0; 
                                   font-size: 1.1em; 
                                   cursor: pointer;
                                   font-weight: bold;
                                   font-family: 'Courier New', Courier, monospace;
                                   text-transform: uppercase;
                                   transition: all 0.2s;
                                   box-shadow: 3px 3px 0 rgba(0,0,0,0.3);">
                        Continue
                    </button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Add click handler to button
            const continueBtn = modalContent.querySelector('#continueBtn');
            continueBtn.addEventListener('click', function() {
                modal.remove();
            });
            
            // Hover effect for button
            continueBtn.addEventListener('mouseenter', function() {
                this.style.transform = 'translate(-2px, -2px)';
                this.style.boxShadow = '5px 5px 0 rgba(0,0,0,0.4)';
            });
            continueBtn.addEventListener('mouseleave', function() {
                this.style.transform = 'translate(0, 0)';
                this.style.boxShadow = '3px 3px 0 rgba(0,0,0,0.3)';
            });
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Close on background click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close on Escape key
            const escHandler = function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', escHandler);
                }
            };
            document.addEventListener('keydown', escHandler);
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizData[currentLecture].questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function submitQuiz() {
            quizSubmitted = true;
            
            // Calculate score
            const lecture = quizData[currentLecture];
            let correct = 0;
            userAnswers.forEach((answer, index) => {
                if (answer === lecture.questions[index].correct) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / lecture.questions.length) * 100);
            
            // EPIC VISUAL EFFECTS FOR HIGH SCORES
            if (percentage === 100) {
                // Perfect score celebration
                createConfetti(window.innerWidth / 2, 100);
                createLightning();
                playSound('mega');
                
                setTimeout(() => {
                    createConfetti(window.innerWidth / 4, 100);
                    createConfetti(window.innerWidth * 3 / 4, 100);
                }, 500);
                
                const perfectText = document.createElement('div');
                perfectText.className = 'mega-combo';
                perfectText.textContent = 'PERFECT!!!';
                perfectText.style.color = '#f39c12';
                document.body.appendChild(perfectText);
                setTimeout(() => perfectText.remove(), 2000);
            } else if (percentage >= 90) {
                // Excellent score
                createConfetti(window.innerWidth / 2, 100);
                playSound('achievement');
                createLightning();
            } else if (percentage >= 70) {
                // Good score
                createConfetti(window.innerWidth / 2, 100);
                playSound('achievement');
            }
            
            // Check for perfect score achievement
            if (percentage === 100) {
                const perfectAchievement = achievementList.find(a => a.id === 'perfect_quiz');
                if (!achievements.includes('perfect_quiz')) {
                    achievements.push('perfect_quiz');
                    localStorage.setItem('achievements', JSON.stringify(achievements));
                    addXP(perfectAchievement.xp);
                    setTimeout(() => showAchievement(perfectAchievement), 1000);
                }
            }
            
            // Award completion bonus XP
            const bonusXP = correct * 5;
            addXP(bonusXP);
            
            // Display score
            document.getElementById('finalScore').textContent = `${correct}/${lecture.questions.length} (${percentage}%)`;
            document.getElementById('bonusXP').innerHTML = `<strong>BONUS XP EARNED: +${bonusXP}</strong>`;
            
            let message = '';
            if (percentage >= 90) {
                message = 'Excellent work! You have mastered this material!';
            } else if (percentage >= 70) {
                message = 'Good job! Keep studying to improve further.';
            } else if (percentage >= 50) {
                message = 'Fair performance. Review the material and try again.';
            } else {
                message = 'You need more practice. Review the lectures carefully.';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            document.getElementById('scoreDisplay').style.display = 'block';
            
            // Go to first question to review
            currentQuestionIndex = 0;
            displayQuestion();
        }

        function backToHome() {
            document.getElementById('quizContainer').classList.remove('active');
            document.getElementById('welcomeScreen').style.display = 'block';
            document.querySelectorAll('.lecture-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            currentLecture = null;
        }

        function saveNote() {
            const noteText = document.getElementById('noteInput').value.trim();
            if (!noteText) {
                alert('Please write something before saving!');
                return;
            }

            const note = {
                id: Date.now(),
                lecture: currentLecture ? quizData[currentLecture].title : 'General Note',
                text: noteText,
                date: new Date().toLocaleString()
            };

            savedNotes.unshift(note);
            localStorage.setItem('dentistryNotes', JSON.stringify(savedNotes));
            
            document.getElementById('noteInput').value = '';
            displaySavedNotes();
            alert('Note saved successfully!');
        }

        function clearNote() {
            document.getElementById('noteInput').value = '';
        }

        function displaySavedNotes() {
            const container = document.getElementById('notesContainer');
            
            if (savedNotes.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center;">No saved notes yet. Start taking notes!</p>';
                return;
            }

            // Clear container first
            container.innerHTML = '';
            
            // Create each note with proper event handling
            savedNotes.forEach((note, index) => {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'note-item';
                
                const lectureName = document.createElement('div');
                lectureName.className = 'note-lecture';
                lectureName.textContent = note.lecture;
                
                const noteText = document.createElement('div');
                noteText.className = 'note-text';
                noteText.textContent = note.text;
                
                const noteDate = document.createElement('div');
                noteDate.className = 'note-date';
                noteDate.textContent = note.date;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-secondary';
                deleteBtn.style.cssText = 'margin-top: 10px; padding: 5px 15px; font-size: 0.9em;';
                deleteBtn.textContent = 'Delete';
                
                // Add click event with closure to capture the correct index
                deleteBtn.onclick = (function(noteIndex) {
                    return function() {
                        if (confirm('Are you sure you want to delete this note?')) {
                            savedNotes.splice(noteIndex, 1);
                            localStorage.setItem('dentistryNotes', JSON.stringify(savedNotes));
                            displaySavedNotes();
                        }
                    };
                })(index);
                
                noteDiv.appendChild(lectureName);
                noteDiv.appendChild(noteText);
                noteDiv.appendChild(noteDate);
                noteDiv.appendChild(deleteBtn);
                container.appendChild(noteDiv);
            });
        }

        function deleteNote(index) {
            // This function is no longer needed but keeping it for compatibility
            if (confirm('Are you sure you want to delete this note?')) {
                savedNotes.splice(index, 1);
                localStorage.setItem('dentistryNotes', JSON.stringify(savedNotes));
                displaySavedNotes();
            }
        }
    </script>
</body>
</html>